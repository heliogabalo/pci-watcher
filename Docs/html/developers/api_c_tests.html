<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LTP C API &mdash; Linux Test Project 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/js/pathTruncator.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LTP shell API" href="api_shell_tests.html" />
    <link rel="prev" title="Test case tutorial" href="test_case_tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Linux Test Project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users/quick_start.html">Installation and tests execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users/setup_tests.html">Tests setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users/supported_systems.html">Supported systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users/stats.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users/test_catalog.html">Test catalog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For developers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup_mailinglist.html">Setting up the Mailing list</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_tests.html">Writing tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_case_tutorial.html">Test case tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LTP C API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#core-ltp-api">Core LTP API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enum-tst-res-flags">enum tst_res_flags</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#constants">Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-res">macro tst_res</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-res-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-res-hexd">macro tst_res_hexd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-res-hexd-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-brk">macro tst_brk</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-brk-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-flush">tst_flush</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-flush-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-safe-fork">macro SAFE_FORK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#safe-fork-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-strerrno">tst_strerrno</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-strsig">tst_strsig</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-strsig-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-strstatus">tst_strstatus</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-strstatus-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-strstatus-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-reap-children">tst_reap_children</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-reap-children-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-option">struct tst_option</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-option-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#members">Members</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-tag">struct tst_tag</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-tag-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-tag-members">Members</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-tag-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-supported-tags-are">The supported tags are</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-ulimit-val">struct tst_ulimit_val</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-ulimit-val-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-ulimit-val-members">Members</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-fs">struct tst_fs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-fs-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-fs-members">Members</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-test">struct tst_test</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-test-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-test-members">Members</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-run-tcases">tst_run_tcases</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-run-tcases-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-reinit">tst_reinit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-reinit-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-run-script">tst_run_script</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-run-script-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-run-script-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-test-tconf">macro TST_TEST_TCONF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-test-tconf-description">Description</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#capabilities">Capabilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#capabilities-introduction">Capabilities introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enum-tst-cap-act">enum tst_cap_act</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-act-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-act-constants">Constants</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-cap-user-header">struct tst_cap_user_header</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-user-header-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-user-header-members">Members</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-cap-user-data">struct tst_cap_user_data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-user-data-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-user-data-members">Members</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-cap">struct tst_cap</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-members">Members</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-cap">macro TST_CAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tst-capget">tst_capget</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-capget-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-capset">tst_capset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-capset-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-cap-action">tst_cap_action</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-action-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-cap-setup">tst_cap_setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-cap-setup-description">Description</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#checkpoints">Checkpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#checkpoints-introduction">Checkpoints introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-checkpoint-wait">macro TST_CHECKPOINT_WAIT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-checkpoint-wait-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-checkpoint-wait2">macro TST_CHECKPOINT_WAIT2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-checkpoint-wait2-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-checkpoint-wake">macro TST_CHECKPOINT_WAKE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-checkpoint-wake-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-checkpoint-wake2">macro TST_CHECKPOINT_WAKE2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-checkpoint-wake2-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-tst-checkpoint-wake-and-wait">macro TST_CHECKPOINT_WAKE_AND_WAIT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-checkpoint-wake-and-wait-description">Description</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#crypto">Crypto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tst-crypto-h-kernel-s-crypto-layer-helpers">tst_crypto.h – kernel’s crypto layer helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tst-crypto-add-alg">tst_crypto_add_alg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-crypto-add-alg-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-crypto-add-alg-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-crypto-del-alg">tst_crypto_del_alg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-crypto-del-alg-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-crypto-del-alg-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-af-alg-h-kernel-crypto-algorithms-af-alg-helpers">tst_af_alg.h – Kernel crypto algorithms (AF_ALG) helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alg-create">tst_alg_create</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-create-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-create-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alg-bind-addr">tst_alg_bind_addr</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-bind-addr-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alg-bind">tst_alg_bind</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-bind-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-try-alg">tst_try_alg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-try-alg-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-have-alg">tst_have_alg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-have-alg-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-require-alg">tst_require_alg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-require-alg-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alg-setkey">tst_alg_setkey</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-setkey-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alg-accept">tst_alg_accept</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-accept-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-accept-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alg-setup">tst_alg_setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-setup-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-setup-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alg-setup-reqfd">tst_alg_setup_reqfd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-setup-reqfd-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-setup-reqfd-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alg-sendmsg">tst_alg_sendmsg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alg-sendmsg-description">Description</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#guarded-buffers">Guarded buffers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#guarded-buffers-introduction">Guarded buffers introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#struct-tst-buffers">struct tst_buffers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-buffers-definition">Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-buffers-members">Members</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-buffers-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-buffers-alloc">tst_buffers_alloc</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-buffers-alloc-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-strdup">tst_strdup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-strdup-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-alloc">tst_alloc</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-alloc-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-aprintf">tst_aprintf</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-aprintf-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-iovec-alloc">tst_iovec_alloc</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-iovec-alloc-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-free-all">tst_free_all</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-free-all-description">Description</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#kernel">Kernel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tst-kernel-bits">tst_kernel_bits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-kernel-bits-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-is-compat-mode">tst_is_compat_mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-is-compat-mode-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-is-compat-mode-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-abi-bits">tst_abi_bits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-abi-bits-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-check-builtin-driver">tst_check_builtin_driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-check-builtin-driver-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-check-driver">tst_check_driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-check-driver-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-check-driver-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-check-preempt-rt">tst_check_preempt_rt</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-check-preempt-rt-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-check-preempt-rt-return">Return</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#option-parsing">Option parsing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#option-parsing-functions">Option parsing functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tst-parse-int">tst_parse_int</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-parse-int-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-parse-long">tst_parse_long</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-parse-long-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-parse-float">tst_parse_float</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-parse-float-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-parse-filesize">tst_parse_filesize</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-parse-filesize-return">Return</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#temporary-directory">Temporary directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tst-purge-dir">tst_purge_dir</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-purge-dir-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-tmpdir-path">tst_tmpdir_path</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-tmpdir-path-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-tmpdir-path-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-tmpdir-genpath">tst_tmpdir_genpath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-tmpdir-genpath-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tst-tmpdir-genpath-return">Return</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ltp-libraries">LTP libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#libltpswap">libltpswap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#macro-make-small-swapfile">macro MAKE_SMALL_SWAPFILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#make-small-swapfile-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-safe-make-small-swapfile">macro SAFE_MAKE_SMALL_SWAPFILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#safe-make-small-swapfile-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-make-swapfile-size">macro MAKE_SWAPFILE_SIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#make-swapfile-size-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-make-swapfile-blks">macro MAKE_SWAPFILE_BLKS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#make-swapfile-blks-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-safe-make-swapfile-size">macro SAFE_MAKE_SWAPFILE_SIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#safe-make-swapfile-size-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macro-safe-make-swapfile-blks">macro SAFE_MAKE_SWAPFILE_BLKS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#safe-make-swapfile-blks-description">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#is-swap-supported">is_swap_supported</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#is-swap-supported-description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-swap-supported-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-max-swapfiles">tst_max_swapfiles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-max-swapfiles-return">Return</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tst-count-swaps">tst_count_swaps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tst-count-swaps-return">Return</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_shell_tests.html">LTP shell API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_network_tests.html">Developing using network API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_kvm_tests.html">Developing using KVM API</a></li>
<li class="toctree-l1"><a class="reference internal" href="ltp_library.html">LTP Library guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_system.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For maintainers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../maintainers/patch_review.html">Patch review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainers/ltp_release_procedure.html">Release process</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Custom Documents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../my-docs/index.html">Welcome to the Project Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Linux Test Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">LTP C API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/developers/api_c_tests.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ltp-c-api">
<h1>LTP C API<a class="headerlink" href="#ltp-c-api" title="Permalink to this heading"></a></h1>
<section id="core-ltp-api">
<h2>Core LTP API<a class="headerlink" href="#core-ltp-api" title="Permalink to this heading"></a></h2>
<section id="enum-tst-res-flags">
<span id="tst-res-flags"></span><h3>enum tst_res_flags<a class="headerlink" href="#enum-tst-res-flags" title="Permalink to this heading"></a></h3>
<dl class="c enum">
<dt class="sig sig-object c" id="c.tst_res_flags">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_res_flags</span></span></span><a class="headerlink" href="#c.tst_res_flags" title="Permalink to this definition"></a><br /></dt>
<dd><p>Test result reporting flags.</p>
</dd></dl>

<section id="definition">
<span id="tst-res-flags-definition"></span><h4>Definition<a class="headerlink" href="#definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">tst_res_flags</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TPASS</span><span class="p">,</span>
<span class="w">    </span><span class="n">TFAIL</span><span class="p">,</span>
<span class="w">    </span><span class="n">TBROK</span><span class="p">,</span>
<span class="w">    </span><span class="n">TWARN</span><span class="p">,</span>
<span class="w">    </span><span class="n">TDEBUG</span><span class="p">,</span>
<span class="w">    </span><span class="n">TINFO</span><span class="p">,</span>
<span class="w">    </span><span class="n">TCONF</span><span class="p">,</span>
<span class="w">    </span><span class="n">TERRNO</span><span class="p">,</span>
<span class="w">    </span><span class="n">TTERRNO</span><span class="p">,</span>
<span class="w">    </span><span class="n">TRERRNO</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="constants">
<span id="tst-res-flags-constants"></span><h4>Constants<a class="headerlink" href="#constants" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>TPASS</dt><dd><p>Reports a single success. Successes increment passed counter and
show up in the test results.</p>
</dd>
<dt>TFAIL</dt><dd><p>Reports a single failure. Failures increment failure counter and
show up in the test results. A failure occurs when test assertion
is broken.</p>
</dd>
<dt>TBROK</dt><dd><p>Reports a single breakage. Breakages increment breakage counter and
show up in the test results. Breakages are reported in cases where a
test couldn’t be executed due to an unexpected failure during the
test setup. The TBROK status is mostly used with <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> which
exit the test immediately. The difference between TBROK and TCONF is
that TCONF is used in cases where optional functionality is missing
while TBROK is used in cases where something that is supposed to
work is broken unexpectedly.</p>
</dd>
<dt>TWARN</dt><dd><p>Reports a single warning. Warnings increment a warning counter and
show up in test results. Warnings are somewhere in the middle between
TBROK and TCONF. Warnings usually appear when something that is
supposed to be working is broken but the test can somehow continue.</p>
</dd>
<dt>TDEBUG</dt><dd><p>Prints additional debugging messages, it does not change the test result counters and
the message is not displayed unless debugging is enabled with -D
test command line parameter.</p>
</dd>
<dt>TINFO</dt><dd><p>Prints an additional information, it does not change the test result
counters but unlike TDEBUG the message is always displayed.</p>
</dd>
<dt>TCONF</dt><dd><p>Reports unsupported configuration. When tests produce this result at
least a subset of test was skipped, because it couldn’t run. The
usual reasons are, missing kernel modules or CONFIG options.
Unsuitable CPU architecture, not enough memory, etc.</p>
</dd>
<dt>TERRNO</dt><dd><p>Combine bitwise with result flags to append errno to the output message.</p>
</dd>
<dt>TTERRNO</dt><dd><p>Combine bitwise with result flags to append error from TST_ERR to
the message. The <code class="xref c c-func docutils literal notranslate"><span class="pre">TST_TEST()</span></code> macros store the errno into the
TST_ERR global variable in order to make sure it’s not change
between the test is done and results are printed.</p>
</dd>
<dt>TRERRNO</dt><dd><p>Combine bitwise with result flags to errno from TST_RET variable
to the message. The <code class="xref c c-func docutils literal notranslate"><span class="pre">TST_TEST()</span></code> macros store return value into the
TST_RET global variable and quite a few, e.g. pthread functions,
return the error value directly instead of storing it to the errno.</p>
</dd>
</dl>
</section>
<section id="description">
<span id="tst-res-flags-description"></span><h4>Description<a class="headerlink" href="#description" title="Permalink to this heading"></a></h4>
<p>A result flag with optional bitwise combination of errno flag are passed to
the <a class="reference internal" href="#c.tst_res" title="tst_res"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_res()</span></code></a> and <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> functions. Each message counts as a single test
result and tests can produce arbitrary number of results, i.e. TPASS, TFAIL,
TBROK, TWARN and TCONF messages. Each such message increases a result
counter in a piece of shared memory, which means that reported results are
accounted immediately even from child processes and there is no need for
result propagation.</p>
</section>
</section>
<section id="macro-tst-res">
<span id="tst-res"></span><h3>macro tst_res<a class="headerlink" href="#macro-tst-res" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.tst_res">
<span class="sig-name descname"><span class="n"><span class="pre">tst_res</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ttype</span></span>, <span class="n"><span class="pre">arg_fmt</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_res" title="Permalink to this definition"></a><br /></dt>
<dd><p>Reports a test result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ttype</strong> – An enum tst_res_type.</p></li>
<li><p><strong>arg_fmt</strong> – A printf-like format.</p></li>
<li><p><strong>ellipsis</strong> (<span><span class="c-expr sig sig-inline c"><span class="n">ellipsis</span></span></span>) – A printf-like parameters.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-res-description">
<span id="id1"></span><h4>Description<a class="headerlink" href="#tst-res-description" title="Permalink to this heading"></a></h4>
<p>This is the main test reporting function. Each time this function is called
with one of TPASS, TFAIL, TCONF, TBROK or TWARN a counter in page of shared
memory is incremented. This means that there is no need to propagate test
results from children and that results are accounted for once this function
returns. The counters are incremented atomically which makes this function
thread-safe.</p>
</section>
</section>
<section id="macro-tst-res-hexd">
<span id="tst-res-hexd"></span><h3>macro tst_res_hexd<a class="headerlink" href="#macro-tst-res-hexd" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.tst_res_hexd">
<span class="sig-name descname"><span class="n"><span class="pre">tst_res_hexd</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ttype</span></span>, <span class="n"><span class="pre">buf</span></span>, <span class="n"><span class="pre">size</span></span>, <span class="n"><span class="pre">arg_fmt</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_res_hexd" title="Permalink to this definition"></a><br /></dt>
<dd><p>Reports a test result along with hex dump of a buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ttype</strong> – An enum tst_res_type.</p></li>
<li><p><strong>buf</strong> – A pointer to a buffer to print in hexadecimal format.</p></li>
<li><p><strong>size</strong> – A size of the buffer.</p></li>
<li><p><strong>arg_fmt</strong> – A printf-like format.</p></li>
<li><p><strong>ellipsis</strong> (<span><span class="c-expr sig sig-inline c"><span class="n">ellipsis</span></span></span>) – A printf-like parameters.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-res-hexd-description">
<span id="id2"></span><h4>Description<a class="headerlink" href="#tst-res-hexd-description" title="Permalink to this heading"></a></h4>
<p>This call is the same as <a class="reference internal" href="#c.tst_res" title="tst_res"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_res()</span></code></a> but includes a pointer and size of the
buffer that is going to be printed in the output in a hexadecimal format.</p>
</section>
</section>
<section id="macro-tst-brk">
<span id="tst-brk"></span><h3>macro tst_brk<a class="headerlink" href="#macro-tst-brk" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.tst_brk">
<span class="sig-name descname"><span class="n"><span class="pre">tst_brk</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ttype</span></span>, <span class="n"><span class="pre">arg_fmt</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_brk" title="Permalink to this definition"></a><br /></dt>
<dd><p>Reports a breakage and exits the test.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ttype</strong> – An enum tst_res_type.</p></li>
<li><p><strong>arg_fmt</strong> – A printf-like format.</p></li>
<li><p><strong>ellipsis</strong> (<span><span class="c-expr sig sig-inline c"><span class="n">ellipsis</span></span></span>) – A printf-like parameters.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-brk-description">
<span id="id3"></span><h4>Description<a class="headerlink" href="#tst-brk-description" title="Permalink to this heading"></a></h4>
<p>Reports either TBROK or TCONF and exits the test immediately. When called
all children in the same process group as the main test library process are
killed. This function, unless in a test cleanup, calls <code class="xref c c-func docutils literal notranslate"><span class="pre">_exit()</span></code> and does not
return.</p>
<p>When test is in <code class="xref c c-func docutils literal notranslate"><span class="pre">cleanup()</span></code> function TBROK is converted into TWARN by the test
library and we attempt to carry on with a cleanup even when <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> was
called. This makes it possible to use <code class="xref c c-func docutils literal notranslate"><span class="pre">SAFE_FOO()</span></code> macros in the test cleanup
without interrupting the cleanup process on a failure.</p>
</section>
</section>
<section id="tst-flush">
<span id="id4"></span><h3>tst_flush<a class="headerlink" href="#tst-flush" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_flush">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_flush</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_flush" title="Permalink to this definition"></a><br /></dt>
<dd><p>Flushes the output file streams.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-flush-description">
<span id="id5"></span><h4>Description<a class="headerlink" href="#tst-flush-description" title="Permalink to this heading"></a></h4>
<p>There are rare cases when we want to flush the output file streams
explicitly, e.g. before we do an action that may crash the test to ensure
that the messages have been written out.</p>
<p>This is also called by the <a class="reference internal" href="#c.SAFE_FORK" title="SAFE_FORK"><code class="xref c c-func docutils literal notranslate"><span class="pre">SAFE_FORK()</span></code></a> because otherwise each child would
end up with the same copy of the file in it’s memory and any messages in
buffers would be multiplied.</p>
</section>
</section>
<section id="macro-safe-fork">
<span id="safe-fork"></span><h3>macro SAFE_FORK<a class="headerlink" href="#macro-safe-fork" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.SAFE_FORK">
<span class="sig-name descname"><span class="n"><span class="pre">SAFE_FORK</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.SAFE_FORK" title="Permalink to this definition"></a><br /></dt>
<dd><p>Forks a test child.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="safe-fork-description">
<span id="id6"></span><h4>Description<a class="headerlink" href="#safe-fork-description" title="Permalink to this heading"></a></h4>
<p>This call makes sure that output file streams are flushed and also handles
errors from <code class="xref c c-func docutils literal notranslate"><span class="pre">fork()</span></code>. Use this instead of <code class="xref c c-func docutils literal notranslate"><span class="pre">fork()</span></code> whenever possible!</p>
</section>
</section>
<section id="tst-strerrno">
<span id="id7"></span><h3>tst_strerrno<a class="headerlink" href="#tst-strerrno" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_strerrno">
<span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_strerrno</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">err</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_strerrno" title="Permalink to this definition"></a><br /></dt>
<dd><p>Converts an errno number into a name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>err</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – An errno number.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="return">
<span id="tst-strerrno-return"></span><h4>Return<a class="headerlink" href="#return" title="Permalink to this heading"></a></h4>
<p>An errno name e.g. “EINVAL”.</p>
</section>
</section>
<section id="tst-strsig">
<span id="id8"></span><h3>tst_strsig<a class="headerlink" href="#tst-strsig" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_strsig">
<span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_strsig</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">sig</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_strsig" title="Permalink to this definition"></a><br /></dt>
<dd><p>Converts a signal number into a name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sig</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – A signal number.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-strsig-return">
<span id="id9"></span><h4>Return<a class="headerlink" href="#tst-strsig-return" title="Permalink to this heading"></a></h4>
<p>A signal name e.g. “SIGINT”.</p>
</section>
</section>
<section id="tst-strstatus">
<span id="id10"></span><h3>tst_strstatus<a class="headerlink" href="#tst-strstatus" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_strstatus">
<span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_strstatus</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">status</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_strstatus" title="Permalink to this definition"></a><br /></dt>
<dd><p>Returns string describing status as returned by <code class="xref c c-func docutils literal notranslate"><span class="pre">wait()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>status</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – A status as returned by <code class="xref c c-func docutils literal notranslate"><span class="pre">wait()</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-strstatus-description">
<span id="id11"></span><h4>Description<a class="headerlink" href="#tst-strstatus-description" title="Permalink to this heading"></a></h4>
<p>WARNING: Not thread safe.</p>
</section>
<section id="tst-strstatus-return">
<span id="id12"></span><h4>Return<a class="headerlink" href="#tst-strstatus-return" title="Permalink to this heading"></a></h4>
<p>A string description for the status e.g. “killed by SIGKILL”.</p>
</section>
</section>
<section id="tst-reap-children">
<span id="id13"></span><h3>tst_reap_children<a class="headerlink" href="#tst-reap-children" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_reap_children">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_reap_children</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_reap_children" title="Permalink to this definition"></a><br /></dt>
<dd><p>Waits for all child processes to exit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-reap-children-description">
<span id="id14"></span><h4>Description<a class="headerlink" href="#tst-reap-children-description" title="Permalink to this heading"></a></h4>
<p>Wait for all children and exit with TBROK if any of them returned a non-zero
exit status.</p>
</section>
</section>
<section id="struct-tst-option">
<span id="tst-option"></span><h3>struct tst_option<a class="headerlink" href="#struct-tst-option" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_option">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_option</span></span></span><a class="headerlink" href="#c.tst_option" title="Permalink to this definition"></a><br /></dt>
<dd><p>Test command line option.</p>
</dd></dl>

<section id="tst-option-definition">
<span id="id15"></span><h4>Definition<a class="headerlink" href="#tst-option-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_option</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">optstr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">arg</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">help</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="members">
<span id="tst-option-members"></span><h4>Members<a class="headerlink" href="#members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>optstr</dt><dd><p>A short command line option, e.g. “a” or “a:”.</p>
</dd>
<dt>arg</dt><dd><p>A pointer to store the option value to.</p>
</dd>
<dt>help</dt><dd><p>A help string for the option displayed when test is passed ‘-h’ on
the command-line.</p>
</dd>
</dl>
</section>
</section>
<section id="struct-tst-tag">
<span id="tst-tag"></span><h3>struct tst_tag<a class="headerlink" href="#struct-tst-tag" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_tag">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_tag</span></span></span><a class="headerlink" href="#c.tst_tag" title="Permalink to this definition"></a><br /></dt>
<dd><p>A test tag.</p>
</dd></dl>

<section id="tst-tag-definition">
<span id="id16"></span><h4>Definition<a class="headerlink" href="#tst-tag-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_tag</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tst-tag-members">
<span id="id17"></span><h4>Members<a class="headerlink" href="#tst-tag-members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>name</dt><dd><p>A tag name.</p>
</dd>
<dt>value</dt><dd><p>A tag value.</p>
</dd>
</dl>
</section>
<section id="tst-tag-description">
<span id="id18"></span><h4>Description<a class="headerlink" href="#tst-tag-description" title="Permalink to this heading"></a></h4>
<p>This structure is used to encode pointers to upstream commits in regression
tests as well as CVE numbers or any additional useful hints.</p>
<p>The content of these tags is printed by the test on a failure to help the
testers with debugging.</p>
</section>
<section id="the-supported-tags-are">
<span id="tst-tag-the-supported-tags-are"></span><h4>The supported tags are<a class="headerlink" href="#the-supported-tags-are" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>“linux-git” with first 12 numbers from an upstream kernel git hash.</p></li>
<li><p>“CVE” with a CVE number e.g. “2000-1234”.</p></li>
<li><p>“glibc-git” with first 12 numbers from an upstream glibc git hash.</p></li>
<li><p>“musl-git” with first 12 numbers from an upstream musl git hash.</p></li>
<li><p>“known-fail” a message describing something that is supposed to work but
rather than that produces a longstanding failures.</p></li>
</ul>
</section>
</section>
<section id="struct-tst-ulimit-val">
<span id="tst-ulimit-val"></span><h3>struct tst_ulimit_val<a class="headerlink" href="#struct-tst-ulimit-val" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_ulimit_val">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_ulimit_val</span></span></span><a class="headerlink" href="#c.tst_ulimit_val" title="Permalink to this definition"></a><br /></dt>
<dd><p>An ulimit resource and value.</p>
</dd></dl>

<section id="tst-ulimit-val-definition">
<span id="id19"></span><h4>Definition<a class="headerlink" href="#tst-ulimit-val-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_ulimit_val</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">resource</span><span class="p">;</span>
<span class="w">    </span><span class="kt">rlim_t</span><span class="w"> </span><span class="n">rlim_cur</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tst-ulimit-val-members">
<span id="id20"></span><h4>Members<a class="headerlink" href="#tst-ulimit-val-members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>resource</dt><dd><p>Which resource limits should be adjusted. See setrlimit(2) for
the list of the RLIMIT_* constants.</p>
</dd>
<dt>rlim_cur</dt><dd><p>A limit value.</p>
</dd>
</dl>
</section>
</section>
<section id="struct-tst-fs">
<span id="tst-fs"></span><h3>struct tst_fs<a class="headerlink" href="#struct-tst-fs" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_fs">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_fs</span></span></span><a class="headerlink" href="#c.tst_fs" title="Permalink to this definition"></a><br /></dt>
<dd><p>A file system type, mkfs and mount options</p>
</dd></dl>

<section id="tst-fs-definition">
<span id="id21"></span><h4>Definition<a class="headerlink" href="#tst-fs-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_fs</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">mkfs_opts</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mkfs_size_opt</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mkfs_ver</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mnt_flags</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">mnt_data</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">min_kver</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tst-fs-members">
<span id="id22"></span><h4>Members<a class="headerlink" href="#tst-fs-members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>type</dt><dd><p>A filesystem type to use.</p>
</dd>
<dt>mkfs_opts</dt><dd><p>A NULL terminated array of options passed to mkfs in the case
of ‘tst_test.format_device’. These options are passed to mkfs
before the device path.</p>
</dd>
<dt>mkfs_size_opt</dt><dd><p>An option passed to mkfs in the case of
‘tst_test.format_device’. The device size in blocks is
passed to mkfs after the device path and can be used to
limit the file system not to use the whole block device.</p>
</dd>
<dt>mkfs_ver</dt><dd><p>mkfs tool version. The string format supports relational
operators such as &lt; &gt; &lt;= &gt;= ==.</p>
</dd>
<dt>mnt_flags</dt><dd><p>MS_* flags passed to mount(2) when the test library mounts a
device in the case of ‘tst_test.mount_device’.</p>
</dd>
<dt>mnt_data</dt><dd><p>The data passed to mount(2) when the test library mounts a device
in the case of ‘tst_test.mount_device’.</p>
</dd>
<dt>min_kver</dt><dd><p>A minimum kernel version supporting the filesystem which has been
created with mkfs.</p>
</dd>
</dl>
</section>
</section>
<section id="struct-tst-test">
<span id="tst-test"></span><h3>struct tst_test<a class="headerlink" href="#struct-tst-test" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_test">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_test</span></span></span><a class="headerlink" href="#c.tst_test" title="Permalink to this definition"></a><br /></dt>
<dd><p>A test description.</p>
</dd></dl>

<section id="tst-test-definition">
<span id="id23"></span><h4>Definition<a class="headerlink" href="#tst-test-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_test</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tcnt</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_option</span><span class="w"> </span><span class="o">*</span><span class="n">options</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">min_kver</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">supported_archs</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">tconf_msg</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_tmpdir</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_root</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">forks_child</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_device</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_checkpoints</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_overlay</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">format_device</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mount_device</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_rofs</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">child_needs_reinit</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">runs_script</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_devfs</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">restore_wallclock</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">all_filesystems</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">skip_in_lockdown</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">skip_in_secureboot</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">skip_in_compat</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_abi_bits</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_hugetlbfs</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">skip_filesystems</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">min_cpus</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">min_mem_avail</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">min_swap_avail</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_hugepage</span><span class="w"> </span><span class="n">hugepages</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">taint_check</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">test_variants</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dev_min_size</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_fs</span><span class="w"> </span><span class="o">*</span><span class="n">filesystems</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">mntpoint</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">timeout</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">runtime</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">setup</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">cleanup</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">test</span><span class="p">)(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">test_nr</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">test_all</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">scall</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">sample</span><span class="p">)(</span><span class="kt">int</span><span class="w"> </span><span class="n">clk_id</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">usec</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">resource_files</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">needs_drivers</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_path_val</span><span class="w"> </span><span class="o">*</span><span class="n">save_restore</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_ulimit_val</span><span class="w"> </span><span class="o">*</span><span class="n">ulimit</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">needs_kconfigs</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_buffers</span><span class="w"> </span><span class="o">*</span><span class="n">bufs</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_cap</span><span class="w"> </span><span class="o">*</span><span class="n">caps</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_tag</span><span class="w"> </span><span class="o">*</span><span class="n">tags</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">needs_cmds</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">tst_cg_ver</span><span class="w"> </span><span class="n">needs_cgroup_ver</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">needs_cgroup_ctrls</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">needs_cgroup_nsdelegate</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tst-test-members">
<span id="id24"></span><h4>Members<a class="headerlink" href="#tst-test-members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>tcnt</dt><dd><p>A number of tests. If set the <code class="xref c c-func docutils literal notranslate"><span class="pre">test()</span></code> callback is called tcnt times
and each time passed an increasing counter value.</p>
</dd>
<dt>options</dt><dd><p>An NULL optstr terminated array of struct tst_option.</p>
</dd>
<dt>min_kver</dt><dd><p>A minimal kernel version the test can run on. e.g. “3.10”.</p>
</dd>
<dt>supported_archs</dt><dd><p>A NULL terminated array of architectures the test runs on
e.g. {“x86_64, “x86”, NULL}. Calls <code class="xref c c-func docutils literal notranslate"><span class="pre">tst_is_on_arch()</span></code> to
check if current CPU architecture is supported and exits
the test with TCONF if it’s not.</p>
</dd>
<dt>tconf_msg</dt><dd><p>If set the test exits with TCONF right after entering the test
library. This is used by the <a class="reference internal" href="#c.TST_TEST_TCONF" title="TST_TEST_TCONF"><code class="xref c c-func docutils literal notranslate"><span class="pre">TST_TEST_TCONF()</span></code></a> macro to disable
tests at compile time.</p>
</dd>
<dt>needs_tmpdir</dt><dd><p>If set a temporary directory is prepared for the test inside
<code class="docutils literal notranslate"><span class="pre">$TMPDIR</span></code> and the test <code class="docutils literal notranslate"><span class="pre">$CWD</span></code> is set to point to it. The content
of the temporary directory is removed automatically after
the test is finished.</p>
</dd>
<dt>needs_root</dt><dd><p>If set the test exit with TCONF unless it’s executed under root
user.</p>
</dd>
<dt>forks_child</dt><dd><p>Has to be set if the test intends to fork children.</p>
</dd>
<dt>needs_device</dt><dd><p>If set a block device is prepared for the test, the device
path and size are set in the struct tst_device variable
called tst_device. If <code class="docutils literal notranslate"><span class="pre">$LTP_DEV</span></code> variable exists in the test
environment the test attempts to use that device first and
only if that fails the test falls back to use loop devices.
This flag implies needs_tmpdir flag because loop device
backing files are created in the test temporary directory.</p>
</dd>
<dt>needs_checkpoints</dt><dd><p>Has to be set if the test wants to use checkpoint
synchronization primitives.</p>
</dd>
<dt>needs_overlay</dt><dd><p>If set overlay file system is mounted on the top of the
file system at tst_test.mntpoint.</p>
</dd>
<dt>format_device</dt><dd><p>Does all tst_test.needs_device would do and also formats
the device with a file system as well.</p>
</dd>
<dt>mount_device</dt><dd><p>Does all tst_test.format_device would do and also mounts the
device at tst_test.mntpoint.</p>
</dd>
<dt>needs_rofs</dt><dd><p>If set a read-only file system is mounted at tst_test.mntpoint.</p>
</dd>
<dt>child_needs_reinit</dt><dd><p>Has to be set if the test needs to call <a class="reference internal" href="#c.tst_reinit" title="tst_reinit"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_reinit()</span></code></a>
from a process started by <code class="xref c c-func docutils literal notranslate"><span class="pre">exec()</span></code>.</p>
</dd>
<dt>runs_script</dt><dd><p>Implies child_needs_reinit and forks_child at the moment.</p>
</dd>
<dt>needs_devfs</dt><dd><p>If set the devfs is mounted at tst_test.mntpoint. This is
needed for tests that need to create device files since tmpfs
at /tmp is usually mounted with ‘nodev’ option.</p>
</dd>
<dt>restore_wallclock</dt><dd><p>Saves wall clock at the start of the test and restores
it at the end with the help of monotonic timers.
Testcases that modify system wallclock use this to
restore the system to the previous state.</p>
</dd>
<dt>all_filesystems</dt><dd><p>If set the test is executed for all supported filesytems,
i.e. file system that is supported by the kernel and has
mkfs installed on the system.The file system is mounted at
tst_test.mntpoint and file system details, e.g. type are set
in the struct tst_device. Each execution is independent,
that means that for each iteration tst_test.setup() is
called at the test start and tst_test.cleanup() is called
at the end and <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> only exits test for a single
file system. That especially means that calling
tst_brk(TCONF, …) in the test setup will skip the
current file system.</p>
</dd>
<dt>skip_in_lockdown</dt><dd><p>Skip the test if kernel lockdown is enabled.</p>
</dd>
<dt>skip_in_secureboot</dt><dd><p>Skip the test if secureboot is enabled.</p>
</dd>
<dt>skip_in_compat</dt><dd><p>Skip the test if we are executing 32bit binary on a 64bit
kernel, i.e. we are testing the kernel compat layer.</p>
</dd>
<dt>needs_abi_bits</dt><dd><p>Skip the test if runs on a different kernel ABI than
requested (on 32bit instead of 64bit or vice versa).
Possible values: 32, 64.</p>
</dd>
<dt>needs_hugetlbfs</dt><dd><p>If set hugetlbfs is mounted at tst_test.mntpoint.</p>
</dd>
<dt>skip_filesystems</dt><dd><p>A NULL terminated array of unsupported file systems. The
test reports TCONF if the file system to be tested is
present in the array. This is especially useful to filter
out unsupported file system when tst_test.all_filesystems
is enabled.</p>
</dd>
<dt>min_cpus</dt><dd><p>Minimal number of online CPUs the test needs to run.</p>
</dd>
<dt>min_mem_avail</dt><dd><p>Minimal amount of available RAM memory in megabytes required
for the test to run.</p>
</dd>
<dt>min_swap_avail</dt><dd><p>Minimal amount of available swap memory in megabytes
required for the test to run.</p>
</dd>
<dt>hugepages</dt><dd><p>An interface to reserve hugepages prior running the test.
Request how many hugepages should be reserved in the global
pool and also if having hugepages is required for the test run
or not, i.e. if test should exit with TCONF if the requested
amount of hugepages cannot be reserved. If TST_REQUEST is set
the library will try it’s best to reserve the hugepages and
return the number of available hugepages in tst_hugepages, which
may be 0 if there is no free memory or hugepages are not
supported at all. If TST_NEEDS the requested hugepages are
required for the test and the test exits if it couldn’t be
required. It can also be used to disable hugepages by setting
.hugepages = {TST_NO_HUGEPAGES}. The test library restores the
original poll allocations after the test has finished.</p>
</dd>
<dt>taint_check</dt><dd><p>If set the test fails if kernel is tainted during the test run.
That means <code class="xref c c-func docutils literal notranslate"><span class="pre">tst_taint_init()</span></code> is called during the test setup
and <code class="xref c c-func docutils literal notranslate"><span class="pre">tst_taint_check()</span></code> at the end of the test. If all_filesystems
is set taint check will be performed after each iteration and
testing will be terminated by TBROK if taint is detected.</p>
</dd>
<dt>test_variants</dt><dd><p>If set denotes number of test variant, the test is executed
variants times each time with tst_variant set to different
number. This allows us to run the same test for different
settings. The intended use is to test different syscall
wrappers/variants but the API is generic and does not limit
usage in any way.</p>
</dd>
<dt>dev_min_size</dt><dd><p>A minimal device size in megabytes.</p>
</dd>
<dt>filesystems</dt><dd><p>A NULL type terminated array of per file system type
parameters for mkfs and mount. If the first entry type is NULL
it describes a default parameters for all file system tests.
The rest of the entries the describes per file system type
parameters. If tst_test.all_filesystems is set, the test runs
for all filesystems and uses the array to lookup the mkfs
and mount options. If tst_test.all_filesystems is not set
the test iterates over file system types defined in the array.
If there is only a single entry in the array with a NULL type,
the test runs just once for the default file sytem i.e.
<code class="docutils literal notranslate"><span class="pre">$TST_FS_TYPE</span></code>.</p>
</dd>
<dt>mntpoint</dt><dd><p>A mount point where the test library mounts requested file system.
The directory is created by the library, the test must not create
it itself.</p>
</dd>
<dt>timeout</dt><dd><p>Maximum allowable time in seconds for the entire duration of a test.
By default, the timeout limits the total time for setup, single test
function invocation, and cleanup phases. However, if .runtime is
explicitly set and <code class="xref c c-func docutils literal notranslate"><span class="pre">tst_remaining_runtime()</span></code> is used in the test’s
main loop, the timeout then applies only to the setup and cleanup
phases, as the runtime separately limits the main test execution.
This ensures the test does not hang indefinitely, in the rare case
that the test timeout cannot be accurately determined, it can be
set to a sufficiently large value or TST_UNLIMITED_TIMEOUT to remove
the limit.</p>
</dd>
<dt>runtime</dt><dd><p>Maximum runtime in seconds for the test’s main execution loop.
This should be set for tests that are expected to run longer
than a few seconds and call <code class="xref c c-func docutils literal notranslate"><span class="pre">tst_remaining_runtime()</span></code> in their
main loop to exit gracefully when the runtime is exceeded.
Tests may finish sooner if their task completes (e.g., reaching
a requested number of iterations) before the runtime runs out.
The runtime is fixed and does not scale with timeout multipliers
(e.g., TIMEOUT_MUL), ensuring consistent test duration across
different environments (e.g., debug vs. stock kernels).</p>
</dd>
<dt>setup</dt><dd><p>Setup callback is called once at the start of the test in order to
prepare the test environment.</p>
</dd>
<dt>cleanup</dt><dd><p>Cleanup callback is either called at the end of the test, or in a
case that <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> was called. That means that cleanup must be
able to handle all possible states the test can be in. This
usually means that we have to check if file descriptor was opened
before we attempt to close it, etc.</p>
</dd>
<dt>test</dt><dd><p>A main test function, only one of the tst_test.test and test_all can
be set. When this function is set the tst_test.tcnt must be set to a
positive integer and this function will be executed tcnt times
during a single test iteration. May be executed several times if test
was passed ‘-i’ or ‘-d’ command line parameters.</p>
</dd>
<dt>test_all</dt><dd><p>A main test function, only one of the tst_test.test and test_all
can be set. May be executed several times if test was passed ‘-i’
or ‘-d’ command line parameters.</p>
</dd>
<dt>scall</dt><dd><p>Internal only (timer measurement library).</p>
</dd>
<dt>sample</dt><dd><p>Internal only (timer measurement library).</p>
</dd>
<dt>resource_files</dt><dd><p>A NULL terminated array of filenames that will be copied
to the test temporary directory from the LTP datafiles
directory.</p>
</dd>
<dt>needs_drivers</dt><dd><p>A NULL terminated array of kernel modules required to run
the test. The module has to be build in or present in order
for the test to run.</p>
</dd>
<dt>save_restore</dt><dd><p>A {} terminated array of /proc or /sys files that should
saved at the start of the test and restored at the end. See
<code class="xref c c-func docutils literal notranslate"><span class="pre">tst_sys_conf_save()</span></code> and struct tst_path_val for details.</p>
</dd>
<dt>ulimit</dt><dd><p>A {} terminated array of process limits RLIMIT_* to be adjusted for
the test.</p>
</dd>
<dt>needs_kconfigs</dt><dd><p>A NULL terminated array of kernel config options that are
required for the test. All strings in the array have to be
evaluated to true for the test to run. Boolean operators
and parenthesis are supported, e.g.
“CONFIG_X86_INTEL_UMIP=y | CONFIG_X86_UIMP=y” is evaluated
to true if at least one of the options is present.</p>
</dd>
<dt>bufs</dt><dd><p>A description of guarded buffers to be allocated for the test. Guarded
buffers are buffers with poisoned page allocated right before the start
of the buffer and canary right after the end of the buffer. See
struct tst_buffers and <code class="xref c c-func docutils literal notranslate"><span class="pre">tst_buffer_alloc()</span></code> for details.</p>
</dd>
<dt>caps</dt><dd><p>A {} terminated array of capabilities to change before the start of
the test. See struct tst_cap and <a class="reference internal" href="#c.tst_cap_setup" title="tst_cap_setup"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_cap_setup()</span></code></a> for details.</p>
</dd>
<dt>tags</dt><dd><p>A {} terminated array of test tags. See struct tst_tag for details.</p>
</dd>
<dt>needs_cmds</dt><dd><p>A NULL terminated array of commands required for the test to run.</p>
</dd>
<dt>needs_cgroup_ver</dt><dd><p>If set the test will run only if the specified cgroup
version is present on the system.</p>
</dd>
<dt>needs_cgroup_ctrls</dt><dd><p>A {} terminated array of cgroup controllers the test
needs to run.</p>
</dd>
<dt>needs_cgroup_nsdelegate</dt><dd><p>If set test the will run only if cgroup2 is mounted
with nsdelegate option.</p>
</dd>
</dl>
</section>
</section>
<section id="tst-run-tcases">
<span id="id25"></span><h3>tst_run_tcases<a class="headerlink" href="#tst-run-tcases" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_run_tcases">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_run_tcases</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">argc</span></span>, <span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">argv</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_test" title="tst_test"><span class="n"><span class="pre">tst_test</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">self</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_run_tcases" title="Permalink to this definition"></a><br /></dt>
<dd><p>Entry point to the test library.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>argc</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – An argc that was passed to the <code class="xref c c-func docutils literal notranslate"><span class="pre">main()</span></code>.</p></li>
<li><p><strong>argv</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">char</span><span class="p">*</span></span></span>) – An argv that was passed to the <code class="xref c c-func docutils literal notranslate"><span class="pre">main()</span></code>.</p></li>
<li><p><strong>self</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><a class="reference internal" href="#c.tst_test" title="tst_test"><span class="n">tst_test</span></a><span class="p">*</span></span></span>) – The test description and callbacks packed in the struct tst_test
structure.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-run-tcases-description">
<span id="id26"></span><h4>Description<a class="headerlink" href="#tst-run-tcases-description" title="Permalink to this heading"></a></h4>
<p>A <code class="xref c c-func docutils literal notranslate"><span class="pre">main()</span></code> function which calls this function is added to each test
automatically by including the tst_test.h header. The test has to define the
struct tst_test called test.</p>
<p>This function does not return, i.e. calls <code class="xref c c-func docutils literal notranslate"><span class="pre">exit()</span></code> after the test has finished.</p>
</section>
</section>
<section id="tst-reinit">
<span id="id27"></span><h3>tst_reinit<a class="headerlink" href="#tst-reinit" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_reinit">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_reinit</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_reinit" title="Permalink to this definition"></a><br /></dt>
<dd><p>Reinitialize the test library.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-reinit-description">
<span id="id28"></span><h4>Description<a class="headerlink" href="#tst-reinit-description" title="Permalink to this heading"></a></h4>
<p>In a cases where a test child process calls <code class="xref c c-func docutils literal notranslate"><span class="pre">exec()</span></code> it no longer can access
the test library shared memory and therefore use the test reporting
functions, checkpoint library, etc. This function re-initializes the test
library so that it can be used again.</p>
<p><code class="docutils literal notranslate"><span class="pre">important</span></code> The LTP_IPC_PATH variable must be passed to the program environment.</p>
</section>
</section>
<section id="tst-run-script">
<span id="id29"></span><h3>tst_run_script<a class="headerlink" href="#tst-run-script" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_run_script">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_run_script</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">script_name</span></span>, <span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">params</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_run_script" title="Permalink to this definition"></a><br /></dt>
<dd><p>Prepare the environment and execute a (shell) script.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>script_name</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – A filename of the script.</p></li>
<li><p><strong>params</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">char</span><span class="w"> </span><span class="p">*</span><span class="k">const</span></span></span>) – A NULL terminated array of (shell) script parameters, pass NULL if
none are needed. This what is passed starting from argv[1].</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-run-script-description">
<span id="id30"></span><h4>Description<a class="headerlink" href="#tst-run-script-description" title="Permalink to this heading"></a></h4>
<p>The (shell) script is executed with LTP_IPC_PATH in environment so that the
binary helpers such as <a class="reference internal" href="#tst-res">tst_res</a> or tst_checkpoint work properly when executed
from the script. This also means that the tst_test.runs_script flag needs to
be set.</p>
<p>A shell script has to source the tst_env.sh shell script at the start and
after that it’s free to use tst_res in the same way C code would use.</p>
<p>Example shell script that reports success:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="o">.</span> <span class="n">tst_env</span><span class="o">.</span><span class="n">sh</span>

<span class="n">tst_res</span> <span class="n">TPASS</span> <span class="s2">&quot;Example test works&quot;</span>
</pre></div>
</div>
<p>The call returns a pid in a case that you want to examine the return value
of the script yourself. If you do not need to check the return value
yourself you can use <a class="reference internal" href="#c.tst_reap_children" title="tst_reap_children"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_reap_children()</span></code></a> to wait for the completion. Or let
the test library collect the child automatically, just be wary that the
script and the test both runs concurently at the same time in this case.</p>
</section>
<section id="tst-run-script-return">
<span id="id31"></span><h4>Return<a class="headerlink" href="#tst-run-script-return" title="Permalink to this heading"></a></h4>
<p>A pid of the (shell) script process.</p>
</section>
</section>
<section id="macro-tst-test-tconf">
<span id="tst-test-tconf"></span><h3>macro TST_TEST_TCONF<a class="headerlink" href="#macro-tst-test-tconf" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.TST_TEST_TCONF">
<span class="sig-name descname"><span class="n"><span class="pre">TST_TEST_TCONF</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">message</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TST_TEST_TCONF" title="Permalink to this definition"></a><br /></dt>
<dd><p>Exit tests with a TCONF message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> – Error message (the reason to skip test).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-test-tconf-description">
<span id="id32"></span><h4>Description<a class="headerlink" href="#tst-test-tconf-description" title="Permalink to this heading"></a></h4>
<p>This macro is used in test that couldn’t be compiled either because current
CPU architecture is unsupported or because of missing development libraries.</p>
</section>
</section>
</section>
<section id="capabilities">
<h2>Capabilities<a class="headerlink" href="#capabilities" title="Permalink to this heading"></a></h2>
<section id="capabilities-introduction">
<span id="id33"></span><h3>Capabilities introduction<a class="headerlink" href="#capabilities-introduction" title="Permalink to this heading"></a></h3>
<p>Limited capability operations without libcap.</p>
</section>
<section id="enum-tst-cap-act">
<span id="tst-cap-act"></span><h3>enum tst_cap_act<a class="headerlink" href="#enum-tst-cap-act" title="Permalink to this heading"></a></h3>
<dl class="c enum">
<dt class="sig sig-object c" id="c.tst_cap_act">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_cap_act</span></span></span><a class="headerlink" href="#c.tst_cap_act" title="Permalink to this definition"></a><br /></dt>
<dd><p>A capability action masks.</p>
</dd></dl>

<section id="tst-cap-act-definition">
<span id="id34"></span><h4>Definition<a class="headerlink" href="#tst-cap-act-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">tst_cap_act</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TST_CAP_DROP</span><span class="p">,</span>
<span class="w">    </span><span class="n">TST_CAP_REQ</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="tst-cap-act-constants">
<span id="id35"></span><h4>Constants<a class="headerlink" href="#tst-cap-act-constants" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>TST_CAP_DROP</dt><dd><p>Drop capabilities.</p>
</dd>
<dt>TST_CAP_REQ</dt><dd><p>Add capabilities.</p>
</dd>
</dl>
</section>
</section>
<section id="struct-tst-cap-user-header">
<span id="tst-cap-user-header"></span><h3>struct tst_cap_user_header<a class="headerlink" href="#struct-tst-cap-user-header" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_cap_user_header">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_cap_user_header</span></span></span><a class="headerlink" href="#c.tst_cap_user_header" title="Permalink to this definition"></a><br /></dt>
<dd><p>Kernel <code class="xref c c-func docutils literal notranslate"><span class="pre">capget()</span></code>, <code class="xref c c-func docutils literal notranslate"><span class="pre">capset()</span></code> syscall header.</p>
</dd></dl>

<section id="tst-cap-user-header-definition">
<span id="id36"></span><h4>Definition<a class="headerlink" href="#tst-cap-user-header-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_cap_user_header</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tst-cap-user-header-members">
<span id="id37"></span><h4>Members<a class="headerlink" href="#tst-cap-user-header-members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>version</dt><dd><p>A capability API version.</p>
</dd>
<dt>pid</dt><dd><p>A process to operate on.</p>
</dd>
</dl>
</section>
</section>
<section id="struct-tst-cap-user-data">
<span id="tst-cap-user-data"></span><h3>struct tst_cap_user_data<a class="headerlink" href="#struct-tst-cap-user-data" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_cap_user_data">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_cap_user_data</span></span></span><a class="headerlink" href="#c.tst_cap_user_data" title="Permalink to this definition"></a><br /></dt>
<dd><p>Kernel <code class="xref c c-func docutils literal notranslate"><span class="pre">capset()</span></code>, <code class="xref c c-func docutils literal notranslate"><span class="pre">capget()</span></code> syscall payload.</p>
</dd></dl>

<section id="tst-cap-user-data-definition">
<span id="id38"></span><h4>Definition<a class="headerlink" href="#tst-cap-user-data-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_cap_user_data</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">effective</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">permitted</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">inheritable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tst-cap-user-data-members">
<span id="id39"></span><h4>Members<a class="headerlink" href="#tst-cap-user-data-members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>effective</dt><dd><p>A capability effective set.</p>
</dd>
<dt>permitted</dt><dd><p>A capability permitted set.</p>
</dd>
<dt>inheritable</dt><dd><p>A capability inheritable set.</p>
</dd>
</dl>
</section>
</section>
<section id="struct-tst-cap">
<span id="tst-cap"></span><h3>struct tst_cap<a class="headerlink" href="#struct-tst-cap" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_cap">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_cap</span></span></span><a class="headerlink" href="#c.tst_cap" title="Permalink to this definition"></a><br /></dt>
<dd><p>A capability to alter.</p>
</dd></dl>

<section id="tst-cap-definition">
<span id="id40"></span><h4>Definition<a class="headerlink" href="#tst-cap-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_cap</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">action</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tst-cap-members">
<span id="id41"></span><h4>Members<a class="headerlink" href="#tst-cap-members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>action</dt><dd><p>What should we do, i.e. drop or add a capability.</p>
</dd>
<dt>id</dt><dd><p>A capability id.</p>
</dd>
<dt>name</dt><dd><p>A capability name.</p>
</dd>
</dl>
</section>
<section id="tst-cap-description">
<span id="id42"></span><h4>Description<a class="headerlink" href="#tst-cap-description" title="Permalink to this heading"></a></h4>
<p>This structure is usually constructed with the <a class="reference internal" href="#c.TST_CAP" title="TST_CAP"><code class="xref c c-func docutils literal notranslate"><span class="pre">TST_CAP()</span></code></a> macro so that the
name is created automatically.</p>
</section>
</section>
<section id="macro-tst-cap">
<span id="id43"></span><h3>macro TST_CAP<a class="headerlink" href="#macro-tst-cap" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.TST_CAP">
<span class="sig-name descname"><span class="n"><span class="pre">TST_CAP</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">action</span></span>, <span class="n"><span class="pre">capability</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TST_CAP" title="Permalink to this definition"></a><br /></dt>
<dd><p>Create a struct tst_cap entry.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action</strong> – What should we do, i.e. drop or add capability.</p></li>
<li><p><strong>capability</strong> – A capability id, e.g. CAP_BPF.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="tst-capget">
<span id="id44"></span><h3>tst_capget<a class="headerlink" href="#tst-capget" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_capget">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_capget</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_user_header" title="tst_cap_user_header"><span class="n"><span class="pre">tst_cap_user_header</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hdr</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_user_data" title="tst_cap_user_data"><span class="n"><span class="pre">tst_cap_user_data</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_capget" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the capabilities as decided by hdr.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hdr</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_user_header" title="tst_cap_user_header"><span class="n">tst_cap_user_header</span></a><span class="p">*</span></span></span>) – A capability user header stores a pid to operate on and which
capability API version is used.</p></li>
<li><p><strong>data</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_user_data" title="tst_cap_user_data"><span class="n">tst_cap_user_data</span></a><span class="p">*</span></span></span>) – A memory to store the capabilities to. The memory pointed to by data
should be large enough to store two structs.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-capget-return">
<span id="id45"></span><h4>Return<a class="headerlink" href="#tst-capget-return" title="Permalink to this heading"></a></h4>
<p>Returns 0 on success, -1 on a failure and sets errno.</p>
</section>
</section>
<section id="tst-capset">
<span id="id46"></span><h3>tst_capset<a class="headerlink" href="#tst-capset" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_capset">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_capset</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_user_header" title="tst_cap_user_header"><span class="n"><span class="pre">tst_cap_user_header</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hdr</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_user_data" title="tst_cap_user_data"><span class="n"><span class="pre">tst_cap_user_data</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_capset" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the capabilities as decided by hdr and data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hdr</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_user_header" title="tst_cap_user_header"><span class="n">tst_cap_user_header</span></a><span class="p">*</span></span></span>) – A capability user header stores a pid to operate on and which
capability API version is used.</p></li>
<li><p><strong>data</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_user_data" title="tst_cap_user_data"><span class="n">tst_cap_user_data</span></a><span class="p">*</span></span></span>) – A memory to store the capabilities to. The memory pointed to by data
should be large enough to store two structs.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-capset-return">
<span id="id47"></span><h4>Return<a class="headerlink" href="#tst-capset-return" title="Permalink to this heading"></a></h4>
<p>Returns 0 on success, -1 on a failure and sets errno.</p>
</section>
</section>
<section id="tst-cap-action">
<span id="id48"></span><h3>tst_cap_action<a class="headerlink" href="#tst-cap-action" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_cap_action">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_cap_action</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_cap" title="tst_cap"><span class="n"><span class="pre">tst_cap</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cap</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_cap_action" title="Permalink to this definition"></a><br /></dt>
<dd><p>Add, check or remove a capability.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cap</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><a class="reference internal" href="#c.tst_cap" title="tst_cap"><span class="n">tst_cap</span></a><span class="p">*</span></span></span>) – An {} terminated array of capabilities to alter.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-cap-action-description">
<span id="id49"></span><h4>Description<a class="headerlink" href="#tst-cap-action-description" title="Permalink to this heading"></a></h4>
<p>It will attempt to drop or add capability to the effective set. It will
try to detect if this is needed and whether it can or can’t be done. If it
clearly can not add a privilege to the effective set then it will return
TCONF. However it may fail for some other reason and return TBROK.</p>
<p>This only tries to change the effective set. Some tests may need to change
the inheritable and ambient sets, so that child processes retain some
capability.</p>
</section>
</section>
<section id="tst-cap-setup">
<span id="id50"></span><h3>tst_cap_setup<a class="headerlink" href="#tst-cap-setup" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_cap_setup">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_cap_setup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_cap" title="tst_cap"><span class="n"><span class="pre">tst_cap</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cap</span></span>, <span class="k"><span class="pre">enum</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_act" title="tst_cap_act"><span class="n"><span class="pre">tst_cap_act</span></span></a><span class="w"> </span><span class="n"><span class="pre">action_mask</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_cap_setup" title="Permalink to this definition"></a><br /></dt>
<dd><p>Add, check or remove a capabilities.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cap</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><a class="reference internal" href="#c.tst_cap" title="tst_cap"><span class="n">tst_cap</span></a><span class="p">*</span></span></span>) – An {} terminated array of capabilities to alter.</p></li>
<li><p><strong>action_mask</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">enum</span><span class="w"> </span><a class="reference internal" href="#c.tst_cap_act" title="tst_cap_act"><span class="n">tst_cap_act</span></a></span></span>) – Decides which actions are done, i.e. only drop caps, add them
or both.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-cap-setup-description">
<span id="id51"></span><h4>Description<a class="headerlink" href="#tst-cap-setup-description" title="Permalink to this heading"></a></h4>
<p>Takes a NULL terminated array of structs which describe whether some
capabilities are needed or not and mask that determines subset of the
actions to be performed. Loops over the array and if mask matches the
element action it’s passed to <a class="reference internal" href="#c.tst_cap_action" title="tst_cap_action"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_cap_action()</span></code></a>.</p>
</section>
</section>
</section>
<section id="checkpoints">
<h2>Checkpoints<a class="headerlink" href="#checkpoints" title="Permalink to this heading"></a></h2>
<section id="checkpoints-introduction">
<span id="id52"></span><h3>Checkpoints introduction<a class="headerlink" href="#checkpoints-introduction" title="Permalink to this heading"></a></h3>
<p>Checkpoints implements a futex based synchronization primitive for threads
and processes. When a process calls wait function its execution is suspended
until wake is called for a corresponding checkpoint. Checkpoints are
numbered from 0 and process can use at least hundred of them.</p>
<p>In order to use checkpoints the test must set the tst_test.needs_checkpoints
flag.</p>
</section>
<section id="macro-tst-checkpoint-wait">
<span id="tst-checkpoint-wait"></span><h3>macro TST_CHECKPOINT_WAIT<a class="headerlink" href="#macro-tst-checkpoint-wait" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.TST_CHECKPOINT_WAIT">
<span class="sig-name descname"><span class="n"><span class="pre">TST_CHECKPOINT_WAIT</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TST_CHECKPOINT_WAIT" title="Permalink to this definition"></a><br /></dt>
<dd><p>Waits for a checkpoint.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>id</strong> – A checkpoint id a positive integer.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-checkpoint-wait-description">
<span id="id53"></span><h4>Description<a class="headerlink" href="#tst-checkpoint-wait-description" title="Permalink to this heading"></a></h4>
<p>Suspends thread/process execution until it’s woken up with a wake. The call
does not wait indefinitely it gives up after 10 seconds. If an error
happened or timeout was reached the function calls tst_brk(TBROK, …) which
exits the test.</p>
</section>
</section>
<section id="macro-tst-checkpoint-wait2">
<span id="tst-checkpoint-wait2"></span><h3>macro TST_CHECKPOINT_WAIT2<a class="headerlink" href="#macro-tst-checkpoint-wait2" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.TST_CHECKPOINT_WAIT2">
<span class="sig-name descname"><span class="n"><span class="pre">TST_CHECKPOINT_WAIT2</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">id</span></span>, <span class="n"><span class="pre">msec_timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TST_CHECKPOINT_WAIT2" title="Permalink to this definition"></a><br /></dt>
<dd><p>Waits for a checkpoint.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>id</strong> – A checkpoint id a positive integer.</p></li>
<li><p><strong>msec_timeout</strong> – A timeout.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-checkpoint-wait2-description">
<span id="id54"></span><h4>Description<a class="headerlink" href="#tst-checkpoint-wait2-description" title="Permalink to this heading"></a></h4>
<p>Suspends thread/process execution until it’s woken up with a wake. If an
error happened or timeout was reached the function calls tst_brk(TBROK, …)
which exits the test.</p>
</section>
</section>
<section id="macro-tst-checkpoint-wake">
<span id="tst-checkpoint-wake"></span><h3>macro TST_CHECKPOINT_WAKE<a class="headerlink" href="#macro-tst-checkpoint-wake" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.TST_CHECKPOINT_WAKE">
<span class="sig-name descname"><span class="n"><span class="pre">TST_CHECKPOINT_WAKE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TST_CHECKPOINT_WAKE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Wakes up a checkpoint.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>id</strong> – A checkpoint id a positive integer.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-checkpoint-wake-description">
<span id="id55"></span><h4>Description<a class="headerlink" href="#tst-checkpoint-wake-description" title="Permalink to this heading"></a></h4>
<p>Wakes up a process suspended on a checkpoint and retries if there is no
process suspended on the checkpoint yet. The call does not retry
indefinitely but gives up after 10 seconds. If an error happened or timeout
was reached the function calls tst_brk(TBROK, …) which exits the test.</p>
</section>
</section>
<section id="macro-tst-checkpoint-wake2">
<span id="tst-checkpoint-wake2"></span><h3>macro TST_CHECKPOINT_WAKE2<a class="headerlink" href="#macro-tst-checkpoint-wake2" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.TST_CHECKPOINT_WAKE2">
<span class="sig-name descname"><span class="n"><span class="pre">TST_CHECKPOINT_WAKE2</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">id</span></span>, <span class="n"><span class="pre">nr_wake</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TST_CHECKPOINT_WAKE2" title="Permalink to this definition"></a><br /></dt>
<dd><p>Wakes up several checkpoints.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>id</strong> – A checkpoint id a positive integer.</p></li>
<li><p><strong>nr_wake</strong> – A number of processes to wake.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-checkpoint-wake2-description">
<span id="id56"></span><h4>Description<a class="headerlink" href="#tst-checkpoint-wake2-description" title="Permalink to this heading"></a></h4>
<p>Wakes up nr_wake processes suspended on a checkpoint and retries if there
wasn’t enough process suspended on the checkpoint yet. The call does not
retry indefinitely but gives up if it does not wake nr_wake processes after
10 seconds. If an error happened or timeout was reached the function calls
tst_brk(TBROK, …) which exits the test.</p>
</section>
</section>
<section id="macro-tst-checkpoint-wake-and-wait">
<span id="tst-checkpoint-wake-and-wait"></span><h3>macro TST_CHECKPOINT_WAKE_AND_WAIT<a class="headerlink" href="#macro-tst-checkpoint-wake-and-wait" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.TST_CHECKPOINT_WAKE_AND_WAIT">
<span class="sig-name descname"><span class="n"><span class="pre">TST_CHECKPOINT_WAKE_AND_WAIT</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TST_CHECKPOINT_WAKE_AND_WAIT" title="Permalink to this definition"></a><br /></dt>
<dd><p>Wakes up a checkpoint and immediately waits on it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>id</strong> – A checkpoint id a positive integer.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-checkpoint-wake-and-wait-description">
<span id="id57"></span><h4>Description<a class="headerlink" href="#tst-checkpoint-wake-and-wait-description" title="Permalink to this heading"></a></h4>
<p>This is a combination of <a class="reference internal" href="#c.TST_CHECKPOINT_WAKE" title="TST_CHECKPOINT_WAKE"><code class="xref c c-func docutils literal notranslate"><span class="pre">TST_CHECKPOINT_WAKE()</span></code></a> and <a class="reference internal" href="#c.TST_CHECKPOINT_WAIT" title="TST_CHECKPOINT_WAIT"><code class="xref c c-func docutils literal notranslate"><span class="pre">TST_CHECKPOINT_WAIT()</span></code></a>.</p>
</section>
</section>
</section>
<section id="crypto">
<h2>Crypto<a class="headerlink" href="#crypto" title="Permalink to this heading"></a></h2>
<section id="tst-crypto-h-kernel-s-crypto-layer-helpers">
<span id="id58"></span><h3>tst_crypto.h – kernel’s crypto layer helpers<a class="headerlink" href="#tst-crypto-h-kernel-s-crypto-layer-helpers" title="Permalink to this heading"></a></h3>
<p>Helpers for interacting with kernel’s crypto layer using the netlink
interface.</p>
</section>
<section id="tst-crypto-add-alg">
<span id="id59"></span><h3>tst_crypto_add_alg<a class="headerlink" href="#tst-crypto-add-alg" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_crypto_add_alg">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_crypto_add_alg</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">tst_netlink_context</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">crypto_user_alg</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">alg</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_crypto_add_alg" title="Permalink to this definition"></a><br /></dt>
<dd><p>Add a crypto algorithm to a session.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><span class="n">tst_netlink_context</span><span class="p">*</span></span></span>) – Initialized netlink context</p></li>
<li><p><strong>alg</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">crypto_user_alg</span><span class="p">*</span></span></span>) – The crypto algorithm or module to add.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-crypto-add-alg-description">
<span id="id60"></span><h4>Description<a class="headerlink" href="#tst-crypto-add-alg-description" title="Permalink to this heading"></a></h4>
<p>This requests a new crypto algorithm/engine/module to be initialized by the
kernel. It sends the request contained in alg and then waits for a
response. If sending the message or receiving the ack fails at the netlink
level then <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> with TBROK will be called.</p>
</section>
<section id="tst-crypto-add-alg-return">
<span id="id61"></span><h4>Return<a class="headerlink" href="#tst-crypto-add-alg-return" title="Permalink to this heading"></a></h4>
<p>On success it will return 0 otherwise it will return an inverted
error code from the crypto layer.</p>
</section>
</section>
<section id="tst-crypto-del-alg">
<span id="id62"></span><h3>tst_crypto_del_alg<a class="headerlink" href="#tst-crypto-del-alg" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_crypto_del_alg">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_crypto_del_alg</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">tst_netlink_context</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">crypto_user_alg</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">alg</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">retries</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_crypto_del_alg" title="Permalink to this definition"></a><br /></dt>
<dd><p>Delete a crypto algorithm from a session.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><span class="n">tst_netlink_context</span><span class="p">*</span></span></span>) – Initialized netlink context</p></li>
<li><p><strong>alg</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">crypto_user_alg</span><span class="p">*</span></span></span>) – The crypto algorithm to delete.</p></li>
<li><p><strong>retries</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span></span></span>) – Number of retries before giving up. Recommended value: 1000</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-crypto-del-alg-description">
<span id="id63"></span><h4>Description<a class="headerlink" href="#tst-crypto-del-alg-description" title="Permalink to this heading"></a></h4>
<p>Request that the kernel remove an existing crypto algorithm. This behaves
in a similar way to <a class="reference internal" href="#c.tst_crypto_add_alg" title="tst_crypto_add_alg"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_crypto_add_alg()</span></code></a> except that it is the inverse
operation and that it is not unusual for the crypto layer to return
EBUSY. If EBUSY is returned then the function will internally retry the
operation tst_crypto_session::retries times before giving up and returning
EBUSY.</p>
</section>
<section id="tst-crypto-del-alg-return">
<span id="id64"></span><h4>Return<a class="headerlink" href="#tst-crypto-del-alg-return" title="Permalink to this heading"></a></h4>
<p>Either 0 or an inverted error code from the crypto layer. If called
during cleanup it may return a positive ENODATA value from the LTP
library, you don’t need to log this error as it will already have
been printed by <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a>.</p>
</section>
</section>
<section id="tst-af-alg-h-kernel-crypto-algorithms-af-alg-helpers">
<span id="id65"></span><h3>tst_af_alg.h – Kernel crypto algorithms (AF_ALG) helpers<a class="headerlink" href="#tst-af-alg-h-kernel-crypto-algorithms-af-alg-helpers" title="Permalink to this heading"></a></h3>
<p>Helpers for accessing kernel crypto algorithms via AF_ALG.</p>
<p>See <a class="reference external" href="https://www.kernel.org/doc/html/latest/crypto/userspace-if.html">https://www.kernel.org/doc/html/latest/crypto/userspace-if.html</a>
for more information about AF_ALG.</p>
</section>
<section id="tst-alg-create">
<span id="id66"></span><h3>tst_alg_create<a class="headerlink" href="#tst-alg-create" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alg_create">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_alg_create</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alg_create" title="Permalink to this definition"></a><br /></dt>
<dd><p>Create an AF_ALG algorithm socket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alg-create-description">
<span id="id67"></span><h4>Description<a class="headerlink" href="#tst-alg-create-description" title="Permalink to this heading"></a></h4>
<p>This creates an AF_ALG algorithm socket that is initially not bound to any
particular algorithm.  On failure, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called with TCONF if the
kernel doesn’t support AF_ALG, otherwise TBROK.</p>
</section>
<section id="tst-alg-create-return">
<span id="id68"></span><h4>Return<a class="headerlink" href="#tst-alg-create-return" title="Permalink to this heading"></a></h4>
<p>a new AF_ALG algorithm socket</p>
</section>
</section>
<section id="tst-alg-bind-addr">
<span id="id69"></span><h3>tst_alg_bind_addr<a class="headerlink" href="#tst-alg-bind-addr" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alg_bind_addr">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_alg_bind_addr</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">algfd</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">sockaddr_alg</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">addr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alg_bind_addr" title="Permalink to this definition"></a><br /></dt>
<dd><p>Bind an AF_ALG algorithm socket to an algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algfd</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – An AF_ALG algorithm socket</p></li>
<li><p><strong>addr</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">sockaddr_alg</span><span class="p">*</span></span></span>) – A structure which specifies the algorithm to use</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alg-bind-addr-description">
<span id="id70"></span><h4>Description<a class="headerlink" href="#tst-alg-bind-addr-description" title="Permalink to this heading"></a></h4>
<p>On failure, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called with TCONF if the kernel doesn’t support the
specified algorithm, otherwise TBROK.</p>
</section>
</section>
<section id="tst-alg-bind">
<span id="id71"></span><h3>tst_alg_bind<a class="headerlink" href="#tst-alg-bind" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alg_bind">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_alg_bind</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">algfd</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algtype</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algname</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alg_bind" title="Permalink to this definition"></a><br /></dt>
<dd><p>Bind an AF_ALG algorithm socket to an algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algfd</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – An AF_ALG algorithm socket</p></li>
<li><p><strong>algtype</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The type of algorithm, such as “hash” or “skcipher”</p></li>
<li><p><strong>algname</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The name of the algorithm, such as “sha256” or “xts(aes)”</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alg-bind-description">
<span id="id72"></span><h4>Description<a class="headerlink" href="#tst-alg-bind-description" title="Permalink to this heading"></a></h4>
<p>Like <a class="reference internal" href="#c.tst_alg_bind_addr" title="tst_alg_bind_addr"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_alg_bind_addr()</span></code></a>, except this just takes in the algorithm type and
name.  The ‘feat’ and ‘mask’ fields are left 0.</p>
<p>On failure, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called with TCONF if the kernel doesn’t support the
specified algorithm, otherwise TBROK.</p>
</section>
</section>
<section id="tst-try-alg">
<span id="id73"></span><h3>tst_try_alg<a class="headerlink" href="#tst-try-alg" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_try_alg">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_try_alg</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algtype</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algname</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_try_alg" title="Permalink to this definition"></a><br /></dt>
<dd><p>Check for the availability of an algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algtype</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The type of algorithm, such as “hash” or “skcipher”</p></li>
<li><p><strong>algname</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The name of the algorithm, such as “sha256” or “xts(aes)”</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-try-alg-return">
<span id="id74"></span><h4>Return<a class="headerlink" href="#tst-try-alg-return" title="Permalink to this heading"></a></h4>
<p>0 if the algorithm is available, or errno if unavailable.</p>
</section>
</section>
<section id="tst-have-alg">
<span id="id75"></span><h3>tst_have_alg<a class="headerlink" href="#tst-have-alg" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_have_alg">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_have_alg</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algtype</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algname</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_have_alg" title="Permalink to this definition"></a><br /></dt>
<dd><p>Check for the availability of an algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algtype</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The type of algorithm, such as “hash” or “skcipher”</p></li>
<li><p><strong>algname</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The name of the algorithm, such as “sha256” or “xts(aes)”</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-have-alg-return">
<span id="id76"></span><h4>Return<a class="headerlink" href="#tst-have-alg-return" title="Permalink to this heading"></a></h4>
<p>true if the algorithm is available, or false if unavailable
and call <a class="reference internal" href="#c.tst_res" title="tst_res"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_res()</span></code></a> with TCONF. If another error occurs, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called
with TBROK unless algorithm is disabled due FIPS mode (errno ELIBBAD).</p>
</section>
</section>
<section id="tst-require-alg">
<span id="id77"></span><h3>tst_require_alg<a class="headerlink" href="#tst-require-alg" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_require_alg">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_require_alg</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algtype</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algname</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_require_alg" title="Permalink to this definition"></a><br /></dt>
<dd><p>Require the availability of an algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algtype</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The type of algorithm, such as “hash” or “skcipher”</p></li>
<li><p><strong>algname</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The name of the algorithm, such as “sha256” or “xts(aes)”</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-require-alg-description">
<span id="id78"></span><h4>Description<a class="headerlink" href="#tst-require-alg-description" title="Permalink to this heading"></a></h4>
<p>If the algorithm is unavailable, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called with TCONF.
If another error occurs, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called with TBROK.</p>
</section>
</section>
<section id="tst-alg-setkey">
<span id="id79"></span><h3>tst_alg_setkey<a class="headerlink" href="#tst-alg-setkey" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alg_setkey">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_alg_setkey</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">algfd</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">key</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">keylen</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alg_setkey" title="Permalink to this definition"></a><br /></dt>
<dd><p>Assign a cryptographic key to an AF_ALG algorithm socket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algfd</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – An AF_ALG algorithm socket</p></li>
<li><p><strong>key</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="n">uint8_t</span><span class="p">*</span></span></span>) – Pointer to the key.  If NULL, a random key is generated.</p></li>
<li><p><strong>keylen</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span></span></span>) – Length of the key in bytes</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alg-setkey-description">
<span id="id80"></span><h4>Description<a class="headerlink" href="#tst-alg-setkey-description" title="Permalink to this heading"></a></h4>
<p>On failure, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called with TBROK.</p>
</section>
</section>
<section id="tst-alg-accept">
<span id="id81"></span><h3>tst_alg_accept<a class="headerlink" href="#tst-alg-accept" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alg_accept">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_alg_accept</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">algfd</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alg_accept" title="Permalink to this definition"></a><br /></dt>
<dd><p>Create an AF_ALG request socket for the given algorithm socket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algfd</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – An AF_ALG algorithm socket</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alg-accept-description">
<span id="id82"></span><h4>Description<a class="headerlink" href="#tst-alg-accept-description" title="Permalink to this heading"></a></h4>
<p>This creates a request socket for the given algorithm socket, which must be
bound to an algorithm.  The same algorithm socket can have many request
sockets used concurrently to perform independent cryptographic operations,
e.g. hashing or encryption/decryption.  But the key, if any, that has been
assigned to the algorithm is shared by all request sockets.</p>
<p>On failure, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called with TBROK.</p>
</section>
<section id="tst-alg-accept-return">
<span id="id83"></span><h4>Return<a class="headerlink" href="#tst-alg-accept-return" title="Permalink to this heading"></a></h4>
<p>a new AF_ALG request socket</p>
</section>
</section>
<section id="tst-alg-setup">
<span id="id84"></span><h3>tst_alg_setup<a class="headerlink" href="#tst-alg-setup" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alg_setup">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_alg_setup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algtype</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algname</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">key</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">keylen</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alg_setup" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set up an AF_ALG algorithm socket for the given algorithm w/ given key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algtype</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The type of algorithm, such as “hash” or “skcipher”</p></li>
<li><p><strong>algname</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The name of the algorithm, such as “sha256” or “xts(aes)”</p></li>
<li><p><strong>key</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="n">uint8_t</span><span class="p">*</span></span></span>) – The key to use (optional)</p></li>
<li><p><strong>keylen</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span></span></span>) – The length of the key in bytes (optional)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alg-setup-description">
<span id="id85"></span><h4>Description<a class="headerlink" href="#tst-alg-setup-description" title="Permalink to this heading"></a></h4>
<p>This is a helper function which creates an AF_ALG algorithm socket, binds it
to the specified algorithm, and optionally sets a key.  If keylen is 0 then
no key is set; otherwise if key is NULL a key of the given length is randomly
generated and set; otherwise the given key is set.</p>
</section>
<section id="tst-alg-setup-return">
<span id="id86"></span><h4>Return<a class="headerlink" href="#tst-alg-setup-return" title="Permalink to this heading"></a></h4>
<p>the AF_ALG algorithm socket that was set up</p>
</section>
</section>
<section id="tst-alg-setup-reqfd">
<span id="id87"></span><h3>tst_alg_setup_reqfd<a class="headerlink" href="#tst-alg-setup-reqfd" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alg_setup_reqfd">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_alg_setup_reqfd</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algtype</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">algname</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">key</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">keylen</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alg_setup_reqfd" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set up an AF_ALG request socket for the given algorithm w/ given key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>algtype</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The type of algorithm, such as “hash” or “skcipher”</p></li>
<li><p><strong>algname</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – The name of the algorithm, such as “sha256” or “xts(aes)”</p></li>
<li><p><strong>key</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="n">uint8_t</span><span class="p">*</span></span></span>) – The key to use (optional)</p></li>
<li><p><strong>keylen</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span></span></span>) – The length of the key in bytes (optional)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alg-setup-reqfd-description">
<span id="id88"></span><h4>Description<a class="headerlink" href="#tst-alg-setup-reqfd-description" title="Permalink to this heading"></a></h4>
<p>This is like <a class="reference internal" href="#c.tst_alg_setup" title="tst_alg_setup"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_alg_setup()</span></code></a>, except this returns a request fd instead of the
alg fd.  The alg fd is closed, so it doesn’t need to be kept track of.</p>
</section>
<section id="tst-alg-setup-reqfd-return">
<span id="id89"></span><h4>Return<a class="headerlink" href="#tst-alg-setup-reqfd-return" title="Permalink to this heading"></a></h4>
<p>the AF_ALG request socket that was set up</p>
</section>
</section>
<section id="tst-alg-sendmsg">
<span id="id90"></span><h3>tst_alg_sendmsg<a class="headerlink" href="#tst-alg-sendmsg" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alg_sendmsg">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_alg_sendmsg</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">reqfd</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">datalen</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">tst_alg_sendmsg_params</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">params</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alg_sendmsg" title="Permalink to this definition"></a><br /></dt>
<dd><p>Send some data to an AF_ALG request socket, including control data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reqfd</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – An AF_ALG request socket</p></li>
<li><p><strong>data</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="p">*</span></span></span>) – The data to send</p></li>
<li><p><strong>datalen</strong> (<span><span class="c-expr sig sig-inline c"><span class="n">size_t</span></span></span>) – The length of data in bytes</p></li>
<li><p><strong>params</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">tst_alg_sendmsg_params</span><span class="p">*</span></span></span>) – Specification of the control data to send</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alg-sendmsg-description">
<span id="id91"></span><h4>Description<a class="headerlink" href="#tst-alg-sendmsg-description" title="Permalink to this heading"></a></h4>
<p>On failure, <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> is called with TBROK.</p>
</section>
</section>
</section>
<section id="guarded-buffers">
<h2>Guarded buffers<a class="headerlink" href="#guarded-buffers" title="Permalink to this heading"></a></h2>
<section id="guarded-buffers-introduction">
<span id="id92"></span><h3>Guarded buffers introduction<a class="headerlink" href="#guarded-buffers-introduction" title="Permalink to this heading"></a></h3>
<p>Guarded buffer has a page with PROT_NONE allocated right before the start of
the buffer and canary after the end of the buffer. That means that any
memory access before the buffer ends with EFAULT or SEGFAULT and any write
after the end of the buffer will be detected because it would overwrite the
canaries.</p>
<p>It should be used for all buffers passed to syscalls to make sure off-by-one
buffer accesses does not happen.</p>
</section>
<section id="struct-tst-buffers">
<span id="tst-buffers"></span><h3>struct tst_buffers<a class="headerlink" href="#struct-tst-buffers" title="Permalink to this heading"></a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tst_buffers">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_buffers</span></span></span><a class="headerlink" href="#c.tst_buffers" title="Permalink to this definition"></a><br /></dt>
<dd><p>A guarded buffer description for allocator.</p>
</dd></dl>

<section id="tst-buffers-definition">
<span id="id93"></span><h4>Definition<a class="headerlink" href="#tst-buffers-definition" title="Permalink to this heading"></a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tst_buffers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">iov_sizes</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tst-buffers-members">
<span id="id94"></span><h4>Members<a class="headerlink" href="#tst-buffers-members" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>ptr</dt><dd><p>A pointer to the pointer to buffer. This is dereferenced and set by the
allocator.</p>
</dd>
<dt>size</dt><dd><p>A buffer size in bytes. Only one of size and iov_sizes can be set.</p>
</dd>
<dt>iov_sizes</dt><dd><p>An -1 terminated array of sizes used to construct a
struct iovec buffers.</p>
</dd>
<dt>str</dt><dd><p>If size is zero and iov_sizes is NULL this string is going to be
copied into the buffer.</p>
</dd>
</dl>
</section>
<section id="tst-buffers-description">
<span id="id95"></span><h4>Description<a class="headerlink" href="#tst-buffers-description" title="Permalink to this heading"></a></h4>
<p>Buffer description consist of a pointer to a pointer and buffer type/size
encoded as a different structure members.</p>
</section>
</section>
<section id="tst-buffers-alloc">
<span id="id96"></span><h3>tst_buffers_alloc<a class="headerlink" href="#tst-buffers-alloc" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_buffers_alloc">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_buffers_alloc</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tst_buffers" title="tst_buffers"><span class="n"><span class="pre">tst_buffers</span></span></a><span class="w"> </span><span class="n"><span class="pre">bufs</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_buffers_alloc" title="Permalink to this definition"></a><br /></dt>
<dd><p>Allocates buffers based on the tst_buffers structure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bufs</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">struct</span><span class="w"> </span><a class="reference internal" href="#c.tst_buffers" title="tst_buffers"><span class="n">tst_buffers</span></a></span></span>) – A NULL terminated array of test buffer descriptions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-buffers-alloc-description">
<span id="id97"></span><h4>Description<a class="headerlink" href="#tst-buffers-alloc-description" title="Permalink to this heading"></a></h4>
<p>This is called from the test library if the tst_test.bufs pointer is set.</p>
</section>
</section>
<section id="tst-strdup">
<span id="id98"></span><h3>tst_strdup<a class="headerlink" href="#tst-strdup" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_strdup">
<span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_strdup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">str</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_strdup" title="Permalink to this definition"></a><br /></dt>
<dd><p>Copies a string into a newly allocated guarded buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>str</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – A string to be duplicated.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-strdup-return">
<span id="id99"></span><h4>Return<a class="headerlink" href="#tst-strdup-return" title="Permalink to this heading"></a></h4>
<p>A pointer to the string duplicated in a guarded buffer.</p>
<p>Allocates a buffer with <a class="reference internal" href="#c.tst_alloc" title="tst_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_alloc()</span></code></a> and copies the string into it.</p>
</section>
</section>
<section id="tst-alloc">
<span id="id100"></span><h3>tst_alloc<a class="headerlink" href="#tst-alloc" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_alloc">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_alloc</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_alloc" title="Permalink to this definition"></a><br /></dt>
<dd><p>Allocates a guarded buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>size</strong> (<span><span class="c-expr sig sig-inline c"><span class="n">size_t</span></span></span>) – A size of the buffer.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-alloc-return">
<span id="id101"></span><h4>Return<a class="headerlink" href="#tst-alloc-return" title="Permalink to this heading"></a></h4>
<p>A newly allocated guarded buffer.</p>
</section>
</section>
<section id="tst-aprintf">
<span id="id102"></span><h3>tst_aprintf<a class="headerlink" href="#tst-aprintf" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_aprintf">
<span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_aprintf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fmt</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_aprintf" title="Permalink to this definition"></a><br /></dt>
<dd><p>Printf into a newly allocated guarded buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fmt</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – A printf-like format.</p></li>
<li><p><strong>ellipsis</strong> (<span><span class="c-expr sig sig-inline c"><span class="n">ellipsis</span></span></span>) – A printf-like parameters.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-aprintf-return">
<span id="id103"></span><h4>Return<a class="headerlink" href="#tst-aprintf-return" title="Permalink to this heading"></a></h4>
<p>A newly allocated buffer.</p>
<p>Allocates a buffer with <a class="reference internal" href="#c.tst_alloc" title="tst_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_alloc()</span></code></a> then prints the data into it.</p>
</section>
</section>
<section id="tst-iovec-alloc">
<span id="id104"></span><h3>tst_iovec_alloc<a class="headerlink" href="#tst-iovec-alloc" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_iovec_alloc">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iovec</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_iovec_alloc</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">sizes</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_iovec_alloc" title="Permalink to this definition"></a><br /></dt>
<dd><p>Allocates a complete iovec structure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sizes</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – A -1 terminated array of buffer sizes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-iovec-alloc-return">
<span id="id105"></span><h4>Return<a class="headerlink" href="#tst-iovec-alloc-return" title="Permalink to this heading"></a></h4>
<p>Newly allocated iovec structure.</p>
</section>
</section>
<section id="tst-free-all">
<span id="id106"></span><h3>tst_free_all<a class="headerlink" href="#tst-free-all" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_free_all">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_free_all</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_free_all" title="Permalink to this definition"></a><br /></dt>
<dd><p>Frees all allocated buffers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-free-all-description">
<span id="id107"></span><h4>Description<a class="headerlink" href="#tst-free-all-description" title="Permalink to this heading"></a></h4>
<p>It’s important to free all guarded buffers because the canaries after the
buffer are checked only when the buffer is being freed.</p>
<p>This is called at the end of the test automatically.</p>
</section>
</section>
</section>
<section id="kernel">
<h2>Kernel<a class="headerlink" href="#kernel" title="Permalink to this heading"></a></h2>
<section id="tst-kernel-bits">
<span id="id108"></span><h3>tst_kernel_bits<a class="headerlink" href="#tst-kernel-bits" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_kernel_bits">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_kernel_bits</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_kernel_bits" title="Permalink to this definition"></a><br /></dt>
<dd><p>Detect if running on 32bit or 64bit kernel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-kernel-bits-return">
<span id="id109"></span><h4>Return<a class="headerlink" href="#tst-kernel-bits-return" title="Permalink to this heading"></a></h4>
<p>32 if the test process is running on 32bit kernel and 64 if on 64bit
kernel.</p>
</section>
</section>
<section id="tst-is-compat-mode">
<span id="id110"></span><h3>tst_is_compat_mode<a class="headerlink" href="#tst-is-compat-mode" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_is_compat_mode">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_is_compat_mode</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_is_compat_mode" title="Permalink to this definition"></a><br /></dt>
<dd><p>Detect if running in compat mode.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-is-compat-mode-description">
<span id="id111"></span><h4>Description<a class="headerlink" href="#tst-is-compat-mode-description" title="Permalink to this heading"></a></h4>
<p>Detect if the test is 32bit binary executed on a 64bit kernel,
i.e. we are testing the kernel compat layer.</p>
</section>
<section id="tst-is-compat-mode-return">
<span id="id112"></span><h4>Return<a class="headerlink" href="#tst-is-compat-mode-return" title="Permalink to this heading"></a></h4>
<p>non-zero if the test process is running in compat mode.</p>
</section>
</section>
<section id="tst-abi-bits">
<span id="id113"></span><h3>tst_abi_bits<a class="headerlink" href="#tst-abi-bits" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_abi_bits">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_abi_bits</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">abi</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_abi_bits" title="Permalink to this definition"></a><br /></dt>
<dd><p>Detect if compiled for required kernel ABI.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>abi</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – kernel ABI bits (32 or 64).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-abi-bits-return">
<span id="id114"></span><h4>Return<a class="headerlink" href="#tst-abi-bits-return" title="Permalink to this heading"></a></h4>
<p>true if compiled for required ABI or false otherwise.</p>
</section>
</section>
<section id="tst-check-builtin-driver">
<span id="id115"></span><h3>tst_check_builtin_driver<a class="headerlink" href="#tst-check-builtin-driver" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_check_builtin_driver">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_check_builtin_driver</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">driver</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_check_builtin_driver" title="Permalink to this definition"></a><br /></dt>
<dd><p>Check if the kernel module is built-in.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>driver</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – the name of the driver.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-check-builtin-driver-return">
<span id="id116"></span><h4>Return<a class="headerlink" href="#tst-check-builtin-driver-return" title="Permalink to this heading"></a></h4>
<p>0 if builtin driver or -1 when driver is missing or config file not
available. On Android <em>always</em> 0 (always expect the driver is available).</p>
</section>
</section>
<section id="tst-check-driver">
<span id="id117"></span><h3>tst_check_driver<a class="headerlink" href="#tst-check-driver" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_check_driver">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_check_driver</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">driver</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_check_driver" title="Permalink to this definition"></a><br /></dt>
<dd><p>Check support for the kernel module.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>driver</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – the name of the driver.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-check-driver-description">
<span id="id118"></span><h4>Description<a class="headerlink" href="#tst-check-driver-description" title="Permalink to this heading"></a></h4>
<p>Check support for the kernel module (both built-in and loadable).</p>
</section>
<section id="tst-check-driver-return">
<span id="id119"></span><h4>Return<a class="headerlink" href="#tst-check-driver-return" title="Permalink to this heading"></a></h4>
<p>0 if the kernel has the driver, -1 when driver is missing or config
file not available. On Android <em>always</em> 0 (always expect the driver is
available).</p>
</section>
</section>
<section id="tst-check-preempt-rt">
<span id="id120"></span><h3>tst_check_preempt_rt<a class="headerlink" href="#tst-check-preempt-rt" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_check_preempt_rt">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_check_preempt_rt</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_check_preempt_rt" title="Permalink to this definition"></a><br /></dt>
<dd><p>Check if the running kernel is RT.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-check-preempt-rt-description">
<span id="id121"></span><h4>Description<a class="headerlink" href="#tst-check-preempt-rt-description" title="Permalink to this heading"></a></h4>
<p>Check support for the kernel module (both built-in and loadable).</p>
</section>
<section id="tst-check-preempt-rt-return">
<span id="id122"></span><h4>Return<a class="headerlink" href="#tst-check-preempt-rt-return" title="Permalink to this heading"></a></h4>
<p>-1 if the kernel is RT, 0 otherwise.</p>
</section>
</section>
</section>
<section id="option-parsing">
<h2>Option parsing<a class="headerlink" href="#option-parsing" title="Permalink to this heading"></a></h2>
<section id="option-parsing-functions">
<span id="id123"></span><h3>Option parsing functions<a class="headerlink" href="#option-parsing-functions" title="Permalink to this heading"></a></h3>
<p>Implements simple helpers on the top of the <code class="xref c c-func docutils literal notranslate"><span class="pre">strtol()</span></code> and <code class="xref c c-func docutils literal notranslate"><span class="pre">strtod()</span></code> for
command line option parsing.</p>
</section>
<section id="tst-parse-int">
<span id="id124"></span><h3>tst_parse_int<a class="headerlink" href="#tst-parse-int" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_parse_int">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_parse_int</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">str</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">val</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">min</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">max</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_parse_int" title="Permalink to this definition"></a><br /></dt>
<dd><p>Parse an integer from a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>str</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – A string with an integer number.</p></li>
<li><p><strong>val</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span><span class="p">*</span></span></span>) – A pointer to integer to store the result to.</p></li>
<li><p><strong>min</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – A lower bound, pass INT_MIN for full range.</p></li>
<li><p><strong>max</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">int</span></span></span>) – An upper bound, pass INT_MAX for full range.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-parse-int-return">
<span id="id125"></span><h4>Return<a class="headerlink" href="#tst-parse-int-return" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>A zero if whole string was consumed and the value was within bounds,</dt><dd><p>an errno otherwise.</p>
</dd>
</dl>
</section>
</section>
<section id="tst-parse-long">
<span id="id126"></span><h3>tst_parse_long<a class="headerlink" href="#tst-parse-long" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_parse_long">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_parse_long</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">str</span></span>, <span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">val</span></span>, <span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="n"><span class="pre">min</span></span>, <span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="n"><span class="pre">max</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_parse_long" title="Permalink to this definition"></a><br /></dt>
<dd><p>Parse a long integer from a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>str</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – A string with an integer number.</p></li>
<li><p><strong>val</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">long</span><span class="p">*</span></span></span>) – A pointer to long integer to store the result to.</p></li>
<li><p><strong>min</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">long</span></span></span>) – A lower bound, pass LONG_MIN for full range.</p></li>
<li><p><strong>max</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">long</span></span></span>) – An upper bound, pass LONG_MAX for full range.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-parse-long-return">
<span id="id127"></span><h4>Return<a class="headerlink" href="#tst-parse-long-return" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>A zero if whole string was consumed and the value was within bounds,</dt><dd><p>an errno otherwise.</p>
</dd>
</dl>
</section>
</section>
<section id="tst-parse-float">
<span id="id128"></span><h3>tst_parse_float<a class="headerlink" href="#tst-parse-float" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_parse_float">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_parse_float</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">str</span></span>, <span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">val</span></span>, <span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="n"><span class="pre">min</span></span>, <span class="kt"><span class="pre">float</span></span><span class="w"> </span><span class="n"><span class="pre">max</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_parse_float" title="Permalink to this definition"></a><br /></dt>
<dd><p>Parse a floating point number from a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>str</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – A string with a floating point number.</p></li>
<li><p><strong>val</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">float</span><span class="p">*</span></span></span>) – A pointer to float to store the result to.</p></li>
<li><p><strong>min</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">float</span></span></span>) – A lower bound.</p></li>
<li><p><strong>max</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">float</span></span></span>) – An upper bound.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-parse-float-return">
<span id="id129"></span><h4>Return<a class="headerlink" href="#tst-parse-float-return" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>A zero if whole string was consumed and the value was within bounds,</dt><dd><p>an errno otherwise.</p>
</dd>
</dl>
</section>
</section>
<section id="tst-parse-filesize">
<span id="id130"></span><h3>tst_parse_filesize<a class="headerlink" href="#tst-parse-filesize" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_parse_filesize">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_parse_filesize</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">str</span></span>, <span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">val</span></span>, <span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="n"><span class="pre">min</span></span>, <span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="n"><span class="pre">max</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_parse_filesize" title="Permalink to this definition"></a><br /></dt>
<dd><p>Parse a file size from a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>str</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – A string a positive number optionally followed by an unit, i.e. K, M,
or G for kilobytes, megabytes and gigabytes.</p></li>
<li><p><strong>val</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">*</span></span></span>) – A pointer to long long integer to store the size in bytes to.</p></li>
<li><p><strong>min</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">long</span><span class="w"> </span><span class="kt">long</span></span></span>) – A lower bound.</p></li>
<li><p><strong>max</strong> (<span><span class="c-expr sig sig-inline c"><span class="kt">long</span><span class="w"> </span><span class="kt">long</span></span></span>) – An upper bound.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-parse-filesize-return">
<span id="id131"></span><h4>Return<a class="headerlink" href="#tst-parse-filesize-return" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>A zero if whole string was consumed and the value was within bounds,</dt><dd><p>an errno otherwise.</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="temporary-directory">
<h2>Temporary directory<a class="headerlink" href="#temporary-directory" title="Permalink to this heading"></a></h2>
<section id="tst-purge-dir">
<span id="id132"></span><h3>tst_purge_dir<a class="headerlink" href="#tst-purge-dir" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_purge_dir">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_purge_dir</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">path</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_purge_dir" title="Permalink to this definition"></a><br /></dt>
<dd><p>Wipe the content of given directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – Path of the directory to be wiped.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-purge-dir-description">
<span id="id133"></span><h4>Description<a class="headerlink" href="#tst-purge-dir-description" title="Permalink to this heading"></a></h4>
<p>Wipe the content of given directory but keep the directory itself.</p>
</section>
</section>
<section id="tst-tmpdir-path">
<span id="id134"></span><h3>tst_tmpdir_path<a class="headerlink" href="#tst-tmpdir-path" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_tmpdir_path">
<span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_tmpdir_path</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_tmpdir_path" title="Permalink to this definition"></a><br /></dt>
<dd><p>Returns a pointer to a tmpdir path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-tmpdir-path-description">
<span id="id135"></span><h4>Description<a class="headerlink" href="#tst-tmpdir-path-description" title="Permalink to this heading"></a></h4>
<p>The returned path is allocated and initialized the first time this function is
called, each subsequent call will return the same pointer.</p>
</section>
<section id="tst-tmpdir-path-return">
<span id="id136"></span><h4>Return<a class="headerlink" href="#tst-tmpdir-path-return" title="Permalink to this heading"></a></h4>
<p>A newly allocated path. The memory is freed automatically at the end
of the test. If allocation fails the function calls <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> and
exits the test.</p>
</section>
</section>
<section id="tst-tmpdir-genpath">
<span id="id137"></span><h3>tst_tmpdir_genpath<a class="headerlink" href="#tst-tmpdir-genpath" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_tmpdir_genpath">
<span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tst_tmpdir_genpath</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fmt</span></span>, <span class="p"><span class="pre">...</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_tmpdir_genpath" title="Permalink to this definition"></a><br /></dt>
<dd><p>Construct an absolute path pointing to a file inside tmpdir.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fmt</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – A printf-like format string.</p></li>
<li><p><strong>ellipsis</strong> (<span><span class="c-expr sig sig-inline c"><span class="n">ellipsis</span></span></span>) – A printf-like parameter list.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-tmpdir-genpath-description">
<span id="id138"></span><h4>Description<a class="headerlink" href="#tst-tmpdir-genpath-description" title="Permalink to this heading"></a></h4>
<p>Constructs a path inside tmpdir i.e. adds a prefix pointing to the current
test tmpdir to the string build by the printf-like format.</p>
</section>
<section id="tst-tmpdir-genpath-return">
<span id="id139"></span><h4>Return<a class="headerlink" href="#tst-tmpdir-genpath-return" title="Permalink to this heading"></a></h4>
<p>A newly allocated path. The memory is freed automatically at the end
of the test. If allocation fails the function calls <a class="reference internal" href="#c.tst_brk" title="tst_brk"><code class="xref c c-func docutils literal notranslate"><span class="pre">tst_brk()</span></code></a> and exits the
test.</p>
</section>
</section>
</section>
<section id="ltp-libraries">
<h2>LTP libraries<a class="headerlink" href="#ltp-libraries" title="Permalink to this heading"></a></h2>
<section id="libltpswap">
<span id="id140"></span><h3>libltpswap<a class="headerlink" href="#libltpswap" title="Permalink to this heading"></a></h3>
<p>Contains common content for all swapon/swapoff tests.</p>
</section>
<section id="macro-make-small-swapfile">
<span id="make-small-swapfile"></span><h3>macro MAKE_SMALL_SWAPFILE<a class="headerlink" href="#macro-make-small-swapfile" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.MAKE_SMALL_SWAPFILE">
<span class="sig-name descname"><span class="n"><span class="pre">MAKE_SMALL_SWAPFILE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">swapfile</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.MAKE_SMALL_SWAPFILE" title="Permalink to this definition"></a><br /></dt>
<dd><p>create small swap file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>swapfile</strong> – swap filename.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="make-small-swapfile-description">
<span id="id141"></span><h4>Description<a class="headerlink" href="#make-small-swapfile-description" title="Permalink to this heading"></a></h4>
<p>Macro to create small swap file. Size defined with MINIMAL_SWAP_SIZE_MB.</p>
</section>
</section>
<section id="macro-safe-make-small-swapfile">
<span id="safe-make-small-swapfile"></span><h3>macro SAFE_MAKE_SMALL_SWAPFILE<a class="headerlink" href="#macro-safe-make-small-swapfile" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.SAFE_MAKE_SMALL_SWAPFILE">
<span class="sig-name descname"><span class="n"><span class="pre">SAFE_MAKE_SMALL_SWAPFILE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">swapfile</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.SAFE_MAKE_SMALL_SWAPFILE" title="Permalink to this definition"></a><br /></dt>
<dd><p>create small swap file (safe version).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>swapfile</strong> – swap filename.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="safe-make-small-swapfile-description">
<span id="id142"></span><h4>Description<a class="headerlink" href="#safe-make-small-swapfile-description" title="Permalink to this heading"></a></h4>
<p>Macro to create small swap file. Size defined with MINIMAL_SWAP_SIZE_MB.
Includes safety checks to handle potential errors.</p>
</section>
</section>
<section id="macro-make-swapfile-size">
<span id="make-swapfile-size"></span><h3>macro MAKE_SWAPFILE_SIZE<a class="headerlink" href="#macro-make-swapfile-size" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.MAKE_SWAPFILE_SIZE">
<span class="sig-name descname"><span class="n"><span class="pre">MAKE_SWAPFILE_SIZE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">swapfile</span></span>, <span class="n"><span class="pre">size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.MAKE_SWAPFILE_SIZE" title="Permalink to this definition"></a><br /></dt>
<dd><p>create swap file (MB).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>swapfile</strong> – swap filename.</p></li>
<li><p><strong>size</strong> – swap size in MB.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="make-swapfile-size-description">
<span id="id143"></span><h4>Description<a class="headerlink" href="#make-swapfile-size-description" title="Permalink to this heading"></a></h4>
<p>Macro to create swap file, size specified in megabytes (MB).</p>
</section>
</section>
<section id="macro-make-swapfile-blks">
<span id="make-swapfile-blks"></span><h3>macro MAKE_SWAPFILE_BLKS<a class="headerlink" href="#macro-make-swapfile-blks" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.MAKE_SWAPFILE_BLKS">
<span class="sig-name descname"><span class="n"><span class="pre">MAKE_SWAPFILE_BLKS</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">swapfile</span></span>, <span class="n"><span class="pre">blocks</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.MAKE_SWAPFILE_BLKS" title="Permalink to this definition"></a><br /></dt>
<dd><p>create swap file (blocks).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>swapfile</strong> – swap filename.</p></li>
<li><p><strong>blocks</strong> – number of blocks.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="make-swapfile-blks-description">
<span id="id144"></span><h4>Description<a class="headerlink" href="#make-swapfile-blks-description" title="Permalink to this heading"></a></h4>
<p>Macro to create swap file, size specified in block numbers.</p>
</section>
</section>
<section id="macro-safe-make-swapfile-size">
<span id="safe-make-swapfile-size"></span><h3>macro SAFE_MAKE_SWAPFILE_SIZE<a class="headerlink" href="#macro-safe-make-swapfile-size" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.SAFE_MAKE_SWAPFILE_SIZE">
<span class="sig-name descname"><span class="n"><span class="pre">SAFE_MAKE_SWAPFILE_SIZE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">swapfile</span></span>, <span class="n"><span class="pre">size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.SAFE_MAKE_SWAPFILE_SIZE" title="Permalink to this definition"></a><br /></dt>
<dd><p>create swap file (MB, safe version).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>swapfile</strong> – swap file name.</p></li>
<li><p><strong>size</strong> – swap size in MB.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="safe-make-swapfile-size-description">
<span id="id145"></span><h4>Description<a class="headerlink" href="#safe-make-swapfile-size-description" title="Permalink to this heading"></a></h4>
<p>Macro to safely create swap file, size specified in megabytes (MB).
Includes safety checks to handle potential errors.</p>
</section>
</section>
<section id="macro-safe-make-swapfile-blks">
<span id="safe-make-swapfile-blks"></span><h3>macro SAFE_MAKE_SWAPFILE_BLKS<a class="headerlink" href="#macro-safe-make-swapfile-blks" title="Permalink to this heading"></a></h3>
<dl class="c macro">
<dt class="sig sig-object c" id="c.SAFE_MAKE_SWAPFILE_BLKS">
<span class="sig-name descname"><span class="n"><span class="pre">SAFE_MAKE_SWAPFILE_BLKS</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">swapfile</span></span>, <span class="n"><span class="pre">blocks</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.SAFE_MAKE_SWAPFILE_BLKS" title="Permalink to this definition"></a><br /></dt>
<dd><p>create swap file (block, safe version)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>swapfile</strong> – swap file name.</p></li>
<li><p><strong>blocks</strong> – number of blocks.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="safe-make-swapfile-blks-description">
<span id="id146"></span><h4>Description<a class="headerlink" href="#safe-make-swapfile-blks-description" title="Permalink to this heading"></a></h4>
<p>Macro to safely create swap file, size specified in block numbers.
Includes safety checks to handle potential errors.</p>
</section>
</section>
<section id="is-swap-supported">
<span id="id147"></span><h3>is_swap_supported<a class="headerlink" href="#is-swap-supported" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.is_swap_supported">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">is_swap_supported</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">filename</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.is_swap_supported" title="Permalink to this definition"></a><br /></dt>
<dd><p>Check swapon/swapoff support.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<span><span class="c-expr sig sig-inline c"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">*</span></span></span>) – swap file name.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="is-swap-supported-description">
<span id="id148"></span><h4>Description<a class="headerlink" href="#is-swap-supported-description" title="Permalink to this heading"></a></h4>
<p>Check swapon/swapoff support status of filesystems or files
we are testing on.</p>
</section>
<section id="is-swap-supported-return">
<span id="id149"></span><h4>Return<a class="headerlink" href="#is-swap-supported-return" title="Permalink to this heading"></a></h4>
<p>true if swap is supported, false if not.</p>
</section>
</section>
<section id="tst-max-swapfiles">
<span id="id150"></span><h3>tst_max_swapfiles<a class="headerlink" href="#tst-max-swapfiles" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_max_swapfiles">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_max_swapfiles</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_max_swapfiles" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get kernel constant MAX_SWAPFILES value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-max-swapfiles-return">
<span id="id151"></span><h4>Return<a class="headerlink" href="#tst-max-swapfiles-return" title="Permalink to this heading"></a></h4>
<p>MAX_SWAPFILES value.</p>
</section>
</section>
<section id="tst-count-swaps">
<span id="id152"></span><h3>tst_count_swaps<a class="headerlink" href="#tst-count-swaps" title="Permalink to this heading"></a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tst_count_swaps">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tst_count_swaps</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tst_count_swaps" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the used swapfiles number.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>void</strong> – no arguments</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="tst-count-swaps-return">
<span id="id153"></span><h4>Return<a class="headerlink" href="#tst-count-swaps-return" title="Permalink to this heading"></a></h4>
<p>used swapfiles number.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="test_case_tutorial.html" class="btn btn-neutral float-left" title="Test case tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api_shell_tests.html" class="btn btn-neutral float-right" title="LTP shell API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Linux Test Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>